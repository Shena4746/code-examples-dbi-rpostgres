<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Code Examples for DBI and RPostgres</title>
  <meta name="description" content="Code Examples for DBI and RPostgres" />
  <meta name="generator" content="bookdown 0.27 and GitBook 2.6.7" />

  <meta property="og:title" content="Code Examples for DBI and RPostgres" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="Shena4746/datascience-100knocks-preprocess-R" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Code Examples for DBI and RPostgres" />
  
  
  

<meta name="author" content="Shena" />


<meta name="date" content="2022-07-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  


<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    background-color: #232629;
    color: #7a7c7d;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #7a7c7d;  padding-left: 4px; }
div.sourceCode
  { color: #cfcfc2; background-color: #232629; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span. { color: #cfcfc2; } /* Normal */
code span.al { color: #95da4c; } /* Alert */
code span.an { color: #3f8058; } /* Annotation */
code span.at { color: #2980b9; } /* Attribute */
code span.bn { color: #f67400; } /* BaseN */
code span.bu { color: #7f8c8d; } /* BuiltIn */
code span.cf { color: #fdbc4b; } /* ControlFlow */
code span.ch { color: #3daee9; } /* Char */
code span.cn { color: #27aeae; } /* Constant */
code span.co { color: #7a7c7d; } /* Comment */
code span.cv { color: #7f8c8d; } /* CommentVar */
code span.do { color: #a43340; } /* Documentation */
code span.dt { color: #2980b9; } /* DataType */
code span.dv { color: #f67400; } /* DecVal */
code span.er { color: #da4453; } /* Error */
code span.ex { color: #0099ff; } /* Extension */
code span.fl { color: #f67400; } /* Float */
code span.fu { color: #8e44ad; } /* Function */
code span.im { color: #27ae60; } /* Import */
code span.in { color: #c45b00; } /* Information */
code span.kw { color: #cfcfc2; } /* Keyword */
code span.op { color: #cfcfc2; } /* Operator */
code span.ot { color: #27ae60; } /* Other */
code span.pp { color: #27ae60; } /* Preprocessor */
code span.re { color: #2980b9; } /* RegionMarker */
code span.sc { color: #3daee9; } /* SpecialChar */
code span.ss { color: #da4453; } /* SpecialString */
code span.st { color: #f44f4f; } /* String */
code span.va { color: #27aeae; } /* Variable */
code span.vs { color: #da4453; } /* VerbatimString */
code span.wa { color: #da4453; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path=""><a href="#about-dbi-and-rpostgres"><i class="fa fa-check"></i><b>1</b> About DBI and RPostgres</a><ul>
<li class="chapter" data-level="1.1" data-path=""><a href="#overview"><i class="fa fa-check"></i><b>1.1</b> Overview</a></li>
<li class="chapter" data-level="1.2" data-path=""><a href="#list-of-functions"><i class="fa fa-check"></i><b>1.2</b> List of Functions</a><ul>
<li class="chapter" data-level="1.2.1" data-path=""><a href="#functions-in-dbi"><i class="fa fa-check"></i><b>1.2.1</b> Functions in DBI</a></li>
<li class="chapter" data-level="1.2.2" data-path=""><a href="#functions-in-rpostgres"><i class="fa fa-check"></i><b>1.2.2</b> Functions in RPostgres</a></li>
<li class="chapter" data-level="1.2.3" data-path=""><a href="#functions-with-duplicated-names"><i class="fa fa-check"></i><b>1.2.3</b> Functions with duplicated names</a></li>
<li class="chapter" data-level="1.2.4" data-path=""><a href="#funcions-only-in-dbi"><i class="fa fa-check"></i><b>1.2.4</b> Funcions only in DBI</a></li>
<li class="chapter" data-level="1.2.5" data-path=""><a href="#funcions-only-in-rpostgres"><i class="fa fa-check"></i><b>1.2.5</b> Funcions only in RPostgres</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path=""><a href="#basic-usage"><i class="fa fa-check"></i><b>1.3</b> Basic Usage</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path=""><a href="#Functions-dbi"><i class="fa fa-check"></i><b>2</b> Functions in DBI and RPostgres</a><ul>
<li class="chapter" data-level="2.1" data-path=""><a href="#connecting-and-disconnecting"><i class="fa fa-check"></i><b>2.1</b> Connecting and Disconnecting</a><ul>
<li class="chapter" data-level="2.1.1" data-path=""><a href="#dbcanconnect"><i class="fa fa-check"></i><b>2.1.1</b> <code>dbCanConnect()</code></a></li>
<li class="chapter" data-level="2.1.2" data-path=""><a href="#dbConnect"><i class="fa fa-check"></i><b>2.1.2</b> <code>dbConnect()</code></a></li>
<li class="chapter" data-level="2.1.3" data-path=""><a href="#dbdisconnect"><i class="fa fa-check"></i><b>2.1.3</b> <code>dbDisconnect()</code></a></li>
<li class="chapter" data-level="2.1.4" data-path=""><a href="#dbgetinfo"><i class="fa fa-check"></i><b>2.1.4</b> <code>dbGetInfo()</code></a></li>
<li class="chapter" data-level="2.1.5" data-path=""><a href="#dbisreadonly"><i class="fa fa-check"></i><b>2.1.5</b> <code>dbIsReadOnly()</code></a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path=""><a href="#manipulating-tables"><i class="fa fa-check"></i><b>2.2</b> Manipulating Tables</a><ul>
<li class="chapter" data-level="2.2.1" data-path=""><a href="#dbreadtable"><i class="fa fa-check"></i><b>2.2.1</b> <code>dbReadTable()</code></a></li>
<li class="chapter" data-level="2.2.2" data-path=""><a href="#dbwritetable"><i class="fa fa-check"></i><b>2.2.2</b> <code>dbWriteTable()</code></a></li>
<li class="chapter" data-level="2.2.3" data-path=""><a href="#dbappendtable"><i class="fa fa-check"></i><b>2.2.3</b> <code>dbAppendTable()</code></a></li>
<li class="chapter" data-level="2.2.4" data-path=""><a href="#dbremovetable"><i class="fa fa-check"></i><b>2.2.4</b> <code>dbRemoveTable()</code></a></li>
<li class="chapter" data-level="2.2.5" data-path=""><a href="#dblisttables"><i class="fa fa-check"></i><b>2.2.5</b> <code>dbListTables()</code></a></li>
<li class="chapter" data-level="2.2.6" data-path=""><a href="#dblistfields"><i class="fa fa-check"></i><b>2.2.6</b> <code>dbListFields()</code></a></li>
<li class="chapter" data-level="2.2.7" data-path=""><a href="#dbexiststable"><i class="fa fa-check"></i><b>2.2.7</b> <code>dbExistsTable()</code></a></li>
<li class="chapter" data-level="2.2.8" data-path=""><a href="#dblistobjects"><i class="fa fa-check"></i><b>2.2.8</b> <code>dbListObjects()</code></a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path=""><a href="#queries-and-statements"><i class="fa fa-check"></i><b>2.3</b> Queries and Statements</a><ul>
<li class="chapter" data-level="2.3.1" data-path=""><a href="#dbgetquery"><i class="fa fa-check"></i><b>2.3.1</b> <code>dbGetQuery()</code></a></li>
<li class="chapter" data-level="2.3.2" data-path=""><a href="#dbexecute"><i class="fa fa-check"></i><b>2.3.2</b> <code>dbExecute()</code></a></li>
<li class="chapter" data-level="2.3.3" data-path=""><a href="#dbsendquery"><i class="fa fa-check"></i><b>2.3.3</b> <code>dbSendQuery()</code></a></li>
<li class="chapter" data-level="2.3.4" data-path=""><a href="#dbsendstatement"><i class="fa fa-check"></i><b>2.3.4</b> <code>dbSendStatement()</code></a></li>
<li class="chapter" data-level="2.3.5" data-path=""><a href="#dbbind"><i class="fa fa-check"></i><b>2.3.5</b> <code>dbBind()</code></a></li>
<li class="chapter" data-level="2.3.6" data-path=""><a href="#dbfetch-fetch"><i class="fa fa-check"></i><b>2.3.6</b> <code>dbFetch(), fetch()</code></a></li>
<li class="chapter" data-level="2.3.7" data-path=""><a href="#dbgetrowcount"><i class="fa fa-check"></i><b>2.3.7</b> <code>dbGetRowCount()</code></a></li>
<li class="chapter" data-level="2.3.8" data-path=""><a href="#dbgetrowsaffected"><i class="fa fa-check"></i><b>2.3.8</b> <code>dbGetRowsAffected()</code></a></li>
<li class="chapter" data-level="2.3.9" data-path=""><a href="#dbgetstatement"><i class="fa fa-check"></i><b>2.3.9</b> <code>dbGetStatement()</code></a></li>
<li class="chapter" data-level="2.3.10" data-path=""><a href="#dbhascompleted"><i class="fa fa-check"></i><b>2.3.10</b> <code>dbHasCompleted()</code></a></li>
<li class="chapter" data-level="2.3.11" data-path=""><a href="#dbcolumninfo"><i class="fa fa-check"></i><b>2.3.11</b> <code>dbColumnInfo()</code></a></li>
<li class="chapter" data-level="2.3.12" data-path=""><a href="#dbclearresult"><i class="fa fa-check"></i><b>2.3.12</b> <code>dbClearResult()</code></a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path=""><a href="#sql"><i class="fa fa-check"></i><b>2.4</b> SQL</a><ul>
<li class="chapter" data-level="2.4.1" data-path=""><a href="#sql-1"><i class="fa fa-check"></i><b>2.4.1</b> <code>SQL()</code></a></li>
<li class="chapter" data-level="2.4.2" data-path=""><a href="#dbdatatype"><i class="fa fa-check"></i><b>2.4.2</b> <code>dbDataType()</code></a></li>
<li class="chapter" data-level="2.4.3" data-path=""><a href="#dbquoteidentifier"><i class="fa fa-check"></i><b>2.4.3</b> <code>dbQuoteIdentifier()</code></a></li>
<li class="chapter" data-level="2.4.4" data-path=""><a href="#dbquoteliteral"><i class="fa fa-check"></i><b>2.4.4</b> <code>dbQuoteLiteral()</code></a></li>
<li class="chapter" data-level="2.4.5" data-path=""><a href="#sqlinterpolate"><i class="fa fa-check"></i><b>2.4.5</b> <code>sqlInterpolate()</code></a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Code Examples for DBI and RPostgres</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="header">
<h1 class="title">Code Examples for DBI and RPostgres</h1>
<p class="author"><em>Shena</em></p>
<p class="date"><em>2022-07-10</em></p>
</div>
<div id="about-dbi-and-rpostgres" class="section level1 hasAnchor">
<h1><span class="header-section-number">1</span> About DBI and RPostgres<a href="#about-dbi-and-rpostgres" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(<span class="st">&quot;RPostgres&quot;</span>)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">library</span>(<span class="st">&quot;DBI&quot;</span>)</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">library</span>(<span class="st">&quot;dbplyr&quot;</span>)</a>
<a class="sourceLine" id="cb1-4" title="4"><span class="kw">library</span>(<span class="st">&quot;dplyr&quot;</span>)</a></code></pre></div>
<p>This document is based on the following conditions.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">R.version.string</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="co">## [1] &quot;R version 4.2.0 (2022-04-22)&quot;</span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="kw">packageVersion</span>(<span class="st">&quot;RPostgres&quot;</span>)</a>
<a class="sourceLine" id="cb2-4" title="4"><span class="co">## [1] &#39;1.4.4.9000&#39;</span></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="kw">packageVersion</span>(<span class="st">&quot;DBI&quot;</span>)</a>
<a class="sourceLine" id="cb2-6" title="6"><span class="co">## [1] &#39;1.1.3&#39;</span></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="kw">packageVersion</span>(<span class="st">&quot;dbplyr&quot;</span>)</a>
<a class="sourceLine" id="cb2-8" title="8"><span class="co">## [1] &#39;2.2.1&#39;</span></a>
<a class="sourceLine" id="cb2-9" title="9"><span class="kw">packageVersion</span>(<span class="st">&quot;dplyr&quot;</span>)</a>
<a class="sourceLine" id="cb2-10" title="10"><span class="co">## [1] &#39;1.0.9&#39;</span></a>
<a class="sourceLine" id="cb2-11" title="11"><span class="kw">packageVersion</span>(<span class="st">&quot;purrr&quot;</span>)</a>
<a class="sourceLine" id="cb2-12" title="12"><span class="co">## [1] &#39;0.3.4&#39;</span></a></code></pre></div>
<div id="overview" class="section level2 hasAnchor">
<h2><span class="header-section-number">1.1</span> Overview<a href="#overview" class="anchor-section" aria-label="Anchor link to header"></a></h2>
</div>
<div id="list-of-functions" class="section level2 hasAnchor">
<h2><span class="header-section-number">1.2</span> List of Functions<a href="#list-of-functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="functions-in-dbi" class="section level3 hasAnchor">
<h3><span class="header-section-number">1.2.1</span> Functions in DBI<a href="#functions-in-dbi" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="co"># functions in dbi package</span></a>
<a class="sourceLine" id="cb3-2" title="2">dbi &lt;-<span class="st"> </span><span class="kw">ls</span>(<span class="st">&quot;package:DBI&quot;</span>)</a>
<a class="sourceLine" id="cb3-3" title="3">dbi <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">length</span>() <span class="co"># how many ?</span></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="co">## [1] 67</span></a>
<a class="sourceLine" id="cb3-5" title="5">dbi <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>()</a>
<a class="sourceLine" id="cb3-6" title="6"><span class="co">##  [1] &quot;ANSI&quot;                   &quot;dbAppendTable&quot;          &quot;dbBegin&quot;               </span></a>
<a class="sourceLine" id="cb3-7" title="7"><span class="co">##  [4] &quot;dbBind&quot;                 &quot;dbBreak&quot;                &quot;dbCallProc&quot;            </span></a>
<a class="sourceLine" id="cb3-8" title="8"><span class="co">##  [7] &quot;dbCanConnect&quot;           &quot;dbClearResult&quot;          &quot;dbColumnInfo&quot;          </span></a>
<a class="sourceLine" id="cb3-9" title="9"><span class="co">## [10] &quot;dbCommit&quot;               &quot;dbConnect&quot;              &quot;dbCreateTable&quot;         </span></a>
<a class="sourceLine" id="cb3-10" title="10"><span class="co">## [13] &quot;dbDataType&quot;             &quot;dbDisconnect&quot;           &quot;dbDriver&quot;              </span></a>
<a class="sourceLine" id="cb3-11" title="11"><span class="co">## [16] &quot;dbExecute&quot;              &quot;dbExistsTable&quot;          &quot;dbFetch&quot;               </span></a>
<a class="sourceLine" id="cb3-12" title="12"><span class="co">## [19] &quot;dbGetConnectArgs&quot;       &quot;dbGetDBIVersion&quot;        &quot;dbGetException&quot;        </span></a>
<a class="sourceLine" id="cb3-13" title="13"><span class="co">## [22] &quot;dbGetInfo&quot;              &quot;dbGetQuery&quot;             &quot;dbGetRowCount&quot;         </span></a>
<a class="sourceLine" id="cb3-14" title="14"><span class="co">## [25] &quot;dbGetRowsAffected&quot;      &quot;dbGetStatement&quot;         &quot;dbHasCompleted&quot;        </span></a>
<a class="sourceLine" id="cb3-15" title="15"><span class="co">## [28] &quot;dbIsReadOnly&quot;           &quot;dbIsValid&quot;              &quot;dbListConnections&quot;     </span></a>
<a class="sourceLine" id="cb3-16" title="16"><span class="co">## [31] &quot;dbListFields&quot;           &quot;dbListObjects&quot;          &quot;dbListResults&quot;         </span></a>
<a class="sourceLine" id="cb3-17" title="17"><span class="co">## [34] &quot;dbListTables&quot;           &quot;dbQuoteIdentifier&quot;      &quot;dbQuoteLiteral&quot;        </span></a>
<a class="sourceLine" id="cb3-18" title="18"><span class="co">## [37] &quot;dbQuoteString&quot;          &quot;dbReadTable&quot;            &quot;dbRemoveTable&quot;         </span></a>
<a class="sourceLine" id="cb3-19" title="19"><span class="co">## [40] &quot;dbRollback&quot;             &quot;dbSendQuery&quot;            &quot;dbSendStatement&quot;       </span></a>
<a class="sourceLine" id="cb3-20" title="20"><span class="co">## [43] &quot;dbSetDataMappings&quot;      &quot;dbUnloadDriver&quot;         &quot;dbUnquoteIdentifier&quot;   </span></a>
<a class="sourceLine" id="cb3-21" title="21"><span class="co">## [46] &quot;dbWithTransaction&quot;      &quot;dbWriteTable&quot;           &quot;fetch&quot;                 </span></a>
<a class="sourceLine" id="cb3-22" title="22"><span class="co">## [49] &quot;Id&quot;                     &quot;isSQLKeyword&quot;           &quot;isSQLKeyword.default&quot;  </span></a>
<a class="sourceLine" id="cb3-23" title="23"><span class="co">## [52] &quot;make.db.names&quot;          &quot;make.db.names.default&quot;  &quot;show&quot;                  </span></a>
<a class="sourceLine" id="cb3-24" title="24"><span class="co">## [55] &quot;SQL&quot;                    &quot;sqlAppendTable&quot;         &quot;sqlAppendTableTemplate&quot;</span></a>
<a class="sourceLine" id="cb3-25" title="25"><span class="co">## [58] &quot;sqlColumnToRownames&quot;    &quot;sqlCommentSpec&quot;         &quot;sqlCreateTable&quot;        </span></a>
<a class="sourceLine" id="cb3-26" title="26"><span class="co">## [61] &quot;sqlData&quot;                &quot;sqlInterpolate&quot;         &quot;SQLKeywords&quot;           </span></a>
<a class="sourceLine" id="cb3-27" title="27"><span class="co">## [64] &quot;sqlParseVariables&quot;      &quot;sqlParseVariablesImpl&quot;  &quot;sqlQuoteSpec&quot;          </span></a>
<a class="sourceLine" id="cb3-28" title="28"><span class="co">## [67] &quot;sqlRownamesToColumn&quot;</span></a></code></pre></div>
</div>
<div id="functions-in-rpostgres" class="section level3 hasAnchor">
<h3><span class="header-section-number">1.2.2</span> Functions in RPostgres<a href="#functions-in-rpostgres" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="co"># functions in RPostgres package</span></a>
<a class="sourceLine" id="cb4-2" title="2">rpos &lt;-<span class="st"> </span><span class="kw">ls</span>(<span class="st">&quot;package:RPostgres&quot;</span>)</a>
<a class="sourceLine" id="cb4-3" title="3">rpos <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">length</span>() <span class="co"># how many ?</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="co">## [1] 48</span></a>
<a class="sourceLine" id="cb4-5" title="5">rpos <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>()</a>
<a class="sourceLine" id="cb4-6" title="6"><span class="co">##  [1] &quot;dbAppendTable&quot;         &quot;dbBegin&quot;               &quot;dbBind&quot;               </span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="co">##  [4] &quot;dbCanConnect&quot;          &quot;dbClearResult&quot;         &quot;dbColumnInfo&quot;         </span></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="co">##  [7] &quot;dbCommit&quot;              &quot;dbConnect&quot;             &quot;dbCreateTable&quot;        </span></a>
<a class="sourceLine" id="cb4-9" title="9"><span class="co">## [10] &quot;dbDataType&quot;            &quot;dbDisconnect&quot;          &quot;dbDriver&quot;             </span></a>
<a class="sourceLine" id="cb4-10" title="10"><span class="co">## [13] &quot;dbExecute&quot;             &quot;dbExistsTable&quot;         &quot;dbFetch&quot;              </span></a>
<a class="sourceLine" id="cb4-11" title="11"><span class="co">## [16] &quot;dbGetInfo&quot;             &quot;dbGetQuery&quot;            &quot;dbGetRowCount&quot;        </span></a>
<a class="sourceLine" id="cb4-12" title="12"><span class="co">## [19] &quot;dbGetRowsAffected&quot;     &quot;dbGetStatement&quot;        &quot;dbHasCompleted&quot;       </span></a>
<a class="sourceLine" id="cb4-13" title="13"><span class="co">## [22] &quot;dbIsReadOnly&quot;          &quot;dbIsValid&quot;             &quot;dbListFields&quot;         </span></a>
<a class="sourceLine" id="cb4-14" title="14"><span class="co">## [25] &quot;dbListObjects&quot;         &quot;dbListResults&quot;         &quot;dbListTables&quot;         </span></a>
<a class="sourceLine" id="cb4-15" title="15"><span class="co">## [28] &quot;dbQuoteIdentifier&quot;     &quot;dbQuoteLiteral&quot;        &quot;dbQuoteString&quot;        </span></a>
<a class="sourceLine" id="cb4-16" title="16"><span class="co">## [31] &quot;dbReadTable&quot;           &quot;dbRemoveTable&quot;         &quot;dbRollback&quot;           </span></a>
<a class="sourceLine" id="cb4-17" title="17"><span class="co">## [34] &quot;dbSendQuery&quot;           &quot;dbSendStatement&quot;       &quot;dbUnloadDriver&quot;       </span></a>
<a class="sourceLine" id="cb4-18" title="18"><span class="co">## [37] &quot;dbUnquoteIdentifier&quot;   &quot;dbWithTransaction&quot;     &quot;dbWriteTable&quot;         </span></a>
<a class="sourceLine" id="cb4-19" title="19"><span class="co">## [40] &quot;Id&quot;                    &quot;Postgres&quot;              &quot;postgresDefault&quot;      </span></a>
<a class="sourceLine" id="cb4-20" title="20"><span class="co">## [43] &quot;postgresHasDefault&quot;    &quot;postgresIsTransacting&quot; &quot;postgresWaitForNotify&quot;</span></a>
<a class="sourceLine" id="cb4-21" title="21"><span class="co">## [46] &quot;Redshift&quot;              &quot;show&quot;                  &quot;sqlData&quot;</span></a></code></pre></div>
</div>
<div id="functions-with-duplicated-names" class="section level3 hasAnchor">
<h3><span class="header-section-number">1.2.3</span> Functions with duplicated names<a href="#functions-with-duplicated-names" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You might have noticed that there are quite a few functions with the same name in these packages. They provides the same functionlaity, possibly with the different implementation and efficiecy.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="co"># common functions in DBI and RPostgres</span></a>
<a class="sourceLine" id="cb5-2" title="2">common &lt;-<span class="st"> </span>base<span class="op">::</span><span class="kw">intersect</span>(dbi, rpos)</a>
<a class="sourceLine" id="cb5-3" title="3">common <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">length</span>() <span class="co"># how many ?</span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="co">## [1] 42</span></a>
<a class="sourceLine" id="cb5-5" title="5">common <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>()</a>
<a class="sourceLine" id="cb5-6" title="6"><span class="co">##  [1] &quot;dbAppendTable&quot;       &quot;dbBegin&quot;             &quot;dbBind&quot;             </span></a>
<a class="sourceLine" id="cb5-7" title="7"><span class="co">##  [4] &quot;dbCanConnect&quot;        &quot;dbClearResult&quot;       &quot;dbColumnInfo&quot;       </span></a>
<a class="sourceLine" id="cb5-8" title="8"><span class="co">##  [7] &quot;dbCommit&quot;            &quot;dbConnect&quot;           &quot;dbCreateTable&quot;      </span></a>
<a class="sourceLine" id="cb5-9" title="9"><span class="co">## [10] &quot;dbDataType&quot;          &quot;dbDisconnect&quot;        &quot;dbDriver&quot;           </span></a>
<a class="sourceLine" id="cb5-10" title="10"><span class="co">## [13] &quot;dbExecute&quot;           &quot;dbExistsTable&quot;       &quot;dbFetch&quot;            </span></a>
<a class="sourceLine" id="cb5-11" title="11"><span class="co">## [16] &quot;dbGetInfo&quot;           &quot;dbGetQuery&quot;          &quot;dbGetRowCount&quot;      </span></a>
<a class="sourceLine" id="cb5-12" title="12"><span class="co">## [19] &quot;dbGetRowsAffected&quot;   &quot;dbGetStatement&quot;      &quot;dbHasCompleted&quot;     </span></a>
<a class="sourceLine" id="cb5-13" title="13"><span class="co">## [22] &quot;dbIsReadOnly&quot;        &quot;dbIsValid&quot;           &quot;dbListFields&quot;       </span></a>
<a class="sourceLine" id="cb5-14" title="14"><span class="co">## [25] &quot;dbListObjects&quot;       &quot;dbListResults&quot;       &quot;dbListTables&quot;       </span></a>
<a class="sourceLine" id="cb5-15" title="15"><span class="co">## [28] &quot;dbQuoteIdentifier&quot;   &quot;dbQuoteLiteral&quot;      &quot;dbQuoteString&quot;      </span></a>
<a class="sourceLine" id="cb5-16" title="16"><span class="co">## [31] &quot;dbReadTable&quot;         &quot;dbRemoveTable&quot;       &quot;dbRollback&quot;         </span></a>
<a class="sourceLine" id="cb5-17" title="17"><span class="co">## [34] &quot;dbSendQuery&quot;         &quot;dbSendStatement&quot;     &quot;dbUnloadDriver&quot;     </span></a>
<a class="sourceLine" id="cb5-18" title="18"><span class="co">## [37] &quot;dbUnquoteIdentifier&quot; &quot;dbWithTransaction&quot;   &quot;dbWriteTable&quot;       </span></a>
<a class="sourceLine" id="cb5-19" title="19"><span class="co">## [40] &quot;Id&quot;                  &quot;show&quot;                &quot;sqlData&quot;</span></a></code></pre></div>
<p>We don’t go into the (potentially deep) difference of these twin functions. This document prefers to using <code>DBI::</code> methods as introduced in <a href="https://github.com/r-dbi/RPostgres">GitHub repository of RPostgres package</a>, unless there is a significant difference between them.</p>
</div>
<div id="funcions-only-in-dbi" class="section level3 hasAnchor">
<h3><span class="header-section-number">1.2.4</span> Funcions only in DBI<a href="#funcions-only-in-dbi" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="co"># functions only in DBI</span></a>
<a class="sourceLine" id="cb6-2" title="2">only_in_dbi &lt;-<span class="st"> </span>base<span class="op">::</span><span class="kw">setdiff</span>(dbi, rpos)</a>
<a class="sourceLine" id="cb6-3" title="3">only_in_dbi <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">length</span>() <span class="co"># how many ?</span></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="co">## [1] 25</span></a>
<a class="sourceLine" id="cb6-5" title="5">only_in_dbi <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>()</a>
<a class="sourceLine" id="cb6-6" title="6"><span class="co">##  [1] &quot;ANSI&quot;                   &quot;dbBreak&quot;                &quot;dbCallProc&quot;            </span></a>
<a class="sourceLine" id="cb6-7" title="7"><span class="co">##  [4] &quot;dbGetConnectArgs&quot;       &quot;dbGetDBIVersion&quot;        &quot;dbGetException&quot;        </span></a>
<a class="sourceLine" id="cb6-8" title="8"><span class="co">##  [7] &quot;dbListConnections&quot;      &quot;dbSetDataMappings&quot;      &quot;fetch&quot;                 </span></a>
<a class="sourceLine" id="cb6-9" title="9"><span class="co">## [10] &quot;isSQLKeyword&quot;           &quot;isSQLKeyword.default&quot;   &quot;make.db.names&quot;         </span></a>
<a class="sourceLine" id="cb6-10" title="10"><span class="co">## [13] &quot;make.db.names.default&quot;  &quot;SQL&quot;                    &quot;sqlAppendTable&quot;        </span></a>
<a class="sourceLine" id="cb6-11" title="11"><span class="co">## [16] &quot;sqlAppendTableTemplate&quot; &quot;sqlColumnToRownames&quot;    &quot;sqlCommentSpec&quot;        </span></a>
<a class="sourceLine" id="cb6-12" title="12"><span class="co">## [19] &quot;sqlCreateTable&quot;         &quot;sqlInterpolate&quot;         &quot;SQLKeywords&quot;           </span></a>
<a class="sourceLine" id="cb6-13" title="13"><span class="co">## [22] &quot;sqlParseVariables&quot;      &quot;sqlParseVariablesImpl&quot;  &quot;sqlQuoteSpec&quot;          </span></a>
<a class="sourceLine" id="cb6-14" title="14"><span class="co">## [25] &quot;sqlRownamesToColumn&quot;</span></a></code></pre></div>
</div>
<div id="funcions-only-in-rpostgres" class="section level3 hasAnchor">
<h3><span class="header-section-number">1.2.5</span> Funcions only in RPostgres<a href="#funcions-only-in-rpostgres" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="co"># functions only in RPostgres</span></a>
<a class="sourceLine" id="cb7-2" title="2">only_in_rpos &lt;-<span class="st"> </span>base<span class="op">::</span><span class="kw">setdiff</span>(rpos, dbi)</a>
<a class="sourceLine" id="cb7-3" title="3">only_in_rpos <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">length</span>() <span class="co"># how many ?</span></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="co">## [1] 6</span></a>
<a class="sourceLine" id="cb7-5" title="5">only_in_rpos <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>()</a>
<a class="sourceLine" id="cb7-6" title="6"><span class="co">## [1] &quot;Postgres&quot;              &quot;postgresDefault&quot;       &quot;postgresHasDefault&quot;   </span></a>
<a class="sourceLine" id="cb7-7" title="7"><span class="co">## [4] &quot;postgresIsTransacting&quot; &quot;postgresWaitForNotify&quot; &quot;Redshift&quot;</span></a></code></pre></div>
</div>
</div>
<div id="basic-usage" class="section level2 hasAnchor">
<h2><span class="header-section-number">1.3</span> Basic Usage<a href="#basic-usage" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Before we look at each function, let us describe a typical work flow with these packages.
You may sefaly skip this section as it is independent of what follows.</p>
<p>This section assumes that you have access to a postgres database. If necessary, run the following command to create a new database named ‘demo’.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb8-1" title="1"><span class="fu">sudo</span> service postgresql start</a></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb9-1" title="1"><span class="ex">createdb</span> -p 5432 --owner=your-owner-name --host=localhost --username=your-username demo</a></code></pre></div>
<p>The following code defines the <code>con</code> variable which holds a establised connection to your database.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">con &lt;-<span class="st"> </span>DBI<span class="op">::</span><span class="kw">dbConnect</span>(</a>
<a class="sourceLine" id="cb10-2" title="2">    <span class="dt">drv =</span> RPostgres<span class="op">::</span><span class="kw">Postgres</span>(),</a>
<a class="sourceLine" id="cb10-3" title="3">    <span class="dt">host =</span> <span class="st">&quot;localhost&quot;</span>,</a>
<a class="sourceLine" id="cb10-4" title="4">    <span class="dt">port =</span> <span class="dv">5432</span>,</a>
<a class="sourceLine" id="cb10-5" title="5">    <span class="dt">dbname =</span> <span class="st">&quot;your-database-name&quot;</span>,</a>
<a class="sourceLine" id="cb10-6" title="6">    <span class="dt">user =</span> <span class="st">&quot;your-user&quot;</span>,</a>
<a class="sourceLine" id="cb10-7" title="7">    <span class="dt">password =</span> <span class="st">&quot;your-password&quot;</span></a>
<a class="sourceLine" id="cb10-8" title="8">)</a></code></pre></div>
<p>You should not write this way outside this demo. See <a href="#dbConnect">2.1.2</a>.</p>
<p>Let us observe the list of tables in the connected database.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="co"># demo database is empty</span></a>
<a class="sourceLine" id="cb11-2" title="2">con <span class="op">%&gt;%</span><span class="st"> </span>DBI<span class="op">::</span><span class="kw">dbListTables</span>()</a>
<a class="sourceLine" id="cb11-3" title="3"><span class="co">## [1] &quot;iris&quot;   &quot;mtcars&quot; &quot;cars&quot;</span></a></code></pre></div>
<p><code>dbWriteTable()</code> Creates a remote table from local data.
The last argument is optional.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"><span class="co"># create table by supplying local dataframe</span></a>
<a class="sourceLine" id="cb12-2" title="2">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbWriteTable</span>(<span class="st">&quot;mtcars&quot;</span>, mtcars, <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb12-3" title="3">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbWriteTable</span>(<span class="st">&quot;iris&quot;</span>, iris, <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb12-4" title="4"><span class="co"># check that tables are properly created</span></a>
<a class="sourceLine" id="cb12-5" title="5">DBI<span class="op">::</span><span class="kw">dbListTables</span>(con)</a>
<a class="sourceLine" id="cb12-6" title="6"><span class="co">## [1] &quot;mtcars&quot; &quot;iris&quot;   &quot;cars&quot;</span></a></code></pre></div>
<p>You can also ask the existance of the specific table in the database associated with <code>con</code> variable.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="co"># boolean question about the existance of indivisual table</span></a>
<a class="sourceLine" id="cb13-2" title="2">con <span class="op">%&gt;%</span><span class="st"> </span>DBI<span class="op">::</span><span class="kw">dbExistsTable</span>(<span class="st">&quot;mtcars&quot;</span>)</a>
<a class="sourceLine" id="cb13-3" title="3"><span class="co">## [1] TRUE</span></a></code></pre></div>
<p><code>dbListFields()</code> gets you the list of fields of an indivisual table.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1"><span class="co"># now we have</span></a>
<a class="sourceLine" id="cb14-2" title="2">con <span class="op">%&gt;%</span><span class="st"> </span>DBI<span class="op">::</span><span class="kw">dbListFields</span>(<span class="st">&quot;mtcars&quot;</span>)</a>
<a class="sourceLine" id="cb14-3" title="3"><span class="co">##  [1] &quot;mpg&quot;  &quot;cyl&quot;  &quot;disp&quot; &quot;hp&quot;   &quot;drat&quot; &quot;wt&quot;   &quot;qsec&quot; &quot;vs&quot;   &quot;am&quot;   &quot;gear&quot;</span></a>
<a class="sourceLine" id="cb14-4" title="4"><span class="co">## [11] &quot;carb&quot;</span></a></code></pre></div>
<p><code>dbReadTable()</code> allows you to take a quick peep at a table.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1">con <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-2" title="2"><span class="st">    </span>DBI<span class="op">::</span><span class="kw">dbReadTable</span>(<span class="st">&quot;mtcars&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-3" title="3"><span class="st">    </span><span class="kw">head</span>()</a></code></pre></div>
<pre><code>##    mpg cyl disp  hp drat    wt  qsec vs am gear carb
## 1 21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
## 2 21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
## 3 22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
## 4 21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
## 5 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
## 6 18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</code></pre>
<p>You can use <code>dbSendQuery()</code> to execute a query written as a string. Note that we don’t need a <code>;</code> at the end of the query. Since this method does nothing but sending query, you should keep the returned value to perform appropriate post-processing.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1"><span class="co"># send query and get response variable</span></a>
<a class="sourceLine" id="cb17-2" title="2">rs &lt;-<span class="st"> </span>con <span class="op">%&gt;%</span><span class="st"> </span>DBI<span class="op">::</span><span class="kw">dbSendQuery</span>(<span class="st">&quot;</span></a>
<a class="sourceLine" id="cb17-3" title="3"><span class="st">    SELECT *</span></a>
<a class="sourceLine" id="cb17-4" title="4"><span class="st">    FROM mtcars</span></a>
<a class="sourceLine" id="cb17-5" title="5"><span class="st">    WHERE hp &lt;= 100</span></a>
<a class="sourceLine" id="cb17-6" title="6"><span class="st">&quot;</span>)</a></code></pre></div>
<p><code>dbFetch()</code> shows you the result of the query.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1">rs <span class="op">%&gt;%</span><span class="st"> </span>DBI<span class="op">::</span><span class="kw">dbFetch</span>()</a></code></pre></div>
<pre><code>##    mpg cyl  disp hp drat    wt  qsec vs am gear carb
## 1 22.8   4 108.0 93 3.85 2.320 18.61  1  1    4    1
## 2 24.4   4 146.7 62 3.69 3.190 20.00  1  0    4    2
## 3 22.8   4 140.8 95 3.92 3.150 22.90  1  0    4    2
## 4 32.4   4  78.7 66 4.08 2.200 19.47  1  1    4    1
## 5 30.4   4  75.7 52 4.93 1.615 18.52  1  1    4    2
## 6 33.9   4  71.1 65 4.22 1.835 19.90  1  1    4    1
## 7 21.5   4 120.1 97 3.70 2.465 20.01  1  0    3    1
## 8 27.3   4  79.0 66 4.08 1.935 18.90  1  1    4    1
## 9 26.0   4 120.3 91 4.43 2.140 16.70  0  1    5    2</code></pre>
<p>Don’t forget to do <code>dbClearResult()</code>.
DBI package keeps many kinds of resources associated with the result of the query unless manually cleared. <code>dbClearResult()</code> is responsible for that freeing role.
DBI reference says that</p>
<blockquote>
<p>This step is mandatory for all objects obtained by calling dbSendQuery() or dbSendStatement().</p>
</blockquote>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbClearResult</span>()</a></code></pre></div>
<p>We can write a parameterised query in the following way.
<code>$1</code> and <code>$2</code> corresponds to the first and second argument in the <code>list(100, 120)</code>, respectively.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1">rs &lt;-<span class="st"> </span>con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbSendQuery</span>(<span class="st">&quot;</span></a>
<a class="sourceLine" id="cb21-2" title="2"><span class="st">    SELECT *</span></a>
<a class="sourceLine" id="cb21-3" title="3"><span class="st">    FROM mtcars</span></a>
<a class="sourceLine" id="cb21-4" title="4"><span class="st">    WHERE hp BETWEEN $1 AND $2</span></a>
<a class="sourceLine" id="cb21-5" title="5"><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb21-6" title="6">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbBind</span>(<span class="kw">list</span>(<span class="dv">100</span>, <span class="dv">120</span>))</a>
<a class="sourceLine" id="cb21-7" title="7">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbFetch</span>()</a>
<a class="sourceLine" id="cb21-8" title="8"><span class="co">##    mpg cyl  disp  hp drat    wt  qsec vs am gear carb</span></a>
<a class="sourceLine" id="cb21-9" title="9"><span class="co">## 1 21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4</span></a>
<a class="sourceLine" id="cb21-10" title="10"><span class="co">## 2 21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4</span></a>
<a class="sourceLine" id="cb21-11" title="11"><span class="co">## 3 21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1</span></a>
<a class="sourceLine" id="cb21-12" title="12"><span class="co">## 4 18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1</span></a>
<a class="sourceLine" id="cb21-13" title="13"><span class="co">## 5 30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2</span></a>
<a class="sourceLine" id="cb21-14" title="14"><span class="co">## 6 21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2</span></a>
<a class="sourceLine" id="cb21-15" title="15">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbClearResult</span>()</a></code></pre></div>
<p>You can delete a table by <code>dbRemoveTable()</code>.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" title="1"><span class="co"># remove indivisual table by supplying name string</span></a>
<a class="sourceLine" id="cb22-2" title="2">con <span class="op">%&gt;%</span><span class="st"> </span>DBI<span class="op">::</span><span class="kw">dbRemoveTable</span>(<span class="st">&quot;mtcars&quot;</span>)</a></code></pre></div>
<p>It is often useful to have a function that deletes multiple tables at once based on a pre-defined rule.
The following code is one of the most simplest, deleting all tables.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" title="1"><span class="co"># create mtcars table again to demonstate sumultaneous-removal</span></a>
<a class="sourceLine" id="cb23-2" title="2">con <span class="op">%&gt;%</span><span class="st"> </span>DBI<span class="op">::</span><span class="kw">dbWriteTable</span>(<span class="st">&quot;mtcars&quot;</span>, mtcars, <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb23-3" title="3">DBI<span class="op">::</span><span class="kw">dbListTables</span>(con)</a>
<a class="sourceLine" id="cb23-4" title="4"><span class="co">## [1] &quot;iris&quot;   &quot;mtcars&quot; &quot;cars&quot;</span></a>
<a class="sourceLine" id="cb23-5" title="5"><span class="co"># remove multiple tables at once</span></a>
<a class="sourceLine" id="cb23-6" title="6">con <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb23-7" title="7"><span class="st">    </span>DBI<span class="op">::</span><span class="kw">dbListTables</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb23-8" title="8"><span class="st">    </span>purrr<span class="op">::</span><span class="kw">map_lgl</span>(<span class="op">~</span><span class="st"> </span>DBI<span class="op">::</span><span class="kw">dbRemoveTable</span>(con, .x)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb23-9" title="9"><span class="st">    </span><span class="kw">all</span>()</a>
<a class="sourceLine" id="cb23-10" title="10"><span class="co">## [1] TRUE</span></a>
<a class="sourceLine" id="cb23-11" title="11">DBI<span class="op">::</span><span class="kw">dbListTables</span>(con)</a>
<a class="sourceLine" id="cb23-12" title="12"><span class="co">## character(0)</span></a></code></pre></div>
<p><code>dbDisconnect()</code> terminates the supplied <code>con</code> variable, and closes the connection.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" title="1">con <span class="op">%&gt;%</span><span class="st"> </span>DBI<span class="op">::</span><span class="kw">dbDisconnect</span>()</a></code></pre></div>

</div>
</div>
<div id="Functions-dbi" class="section level1 hasAnchor">
<h1><span class="header-section-number">2</span> Functions in DBI and RPostgres<a href="#Functions-dbi" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>For convenience, we define a function that issues a connection variable. Here we use config package to avoid to write credentials in a code.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" title="1"><span class="co"># depends on config package</span></a>
<a class="sourceLine" id="cb25-2" title="2">issue_con &lt;-<span class="st"> </span><span class="cf">function</span>(service_name) {</a>
<a class="sourceLine" id="cb25-3" title="3">    dw &lt;-<span class="st"> </span>config<span class="op">::</span><span class="kw">get</span>(service_name)</a>
<a class="sourceLine" id="cb25-4" title="4">    DBI<span class="op">::</span><span class="kw">dbConnect</span>(</a>
<a class="sourceLine" id="cb25-5" title="5">        <span class="dt">drv =</span> RPostgres<span class="op">::</span><span class="kw">Postgres</span>(),</a>
<a class="sourceLine" id="cb25-6" title="6">        <span class="dt">host =</span> dw<span class="op">$</span>host,</a>
<a class="sourceLine" id="cb25-7" title="7">        <span class="dt">port =</span> dw<span class="op">$</span>port,</a>
<a class="sourceLine" id="cb25-8" title="8">        <span class="dt">dbname =</span> dw<span class="op">$</span>dbname,</a>
<a class="sourceLine" id="cb25-9" title="9">        <span class="dt">user =</span> dw<span class="op">$</span>user,</a>
<a class="sourceLine" id="cb25-10" title="10">        <span class="dt">password =</span> dw<span class="op">$</span>password</a>
<a class="sourceLine" id="cb25-11" title="11">    )</a>
<a class="sourceLine" id="cb25-12" title="12">}</a></code></pre></div>

<div id="connecting-and-disconnecting" class="section level2 hasAnchor">
<h2><span class="header-section-number">2.1</span> Connecting and Disconnecting<a href="#connecting-and-disconnecting" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="dbcanconnect" class="section level3 hasAnchor">
<h3><span class="header-section-number">2.1.1</span> <code>dbCanConnect()</code><a href="#dbcanconnect" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Checks if a connection to a DBMS can be established</li>
<li>Retruns logical.</li>
<li>If <code>FALSE</code>, it comes with a reason for failure.</li>
</ul>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" title="1">DBI<span class="op">::</span><span class="kw">dbCanConnect</span>(<span class="dt">drv =</span> RPostgres<span class="op">::</span><span class="kw">Postgres</span>())</a>
<a class="sourceLine" id="cb26-2" title="2"><span class="co">## [1] TRUE</span></a>
<a class="sourceLine" id="cb26-3" title="3">RPostgres<span class="op">::</span><span class="kw">dbCanConnect</span>(<span class="dt">drv =</span> RPostgres<span class="op">::</span><span class="kw">Postgres</span>())</a>
<a class="sourceLine" id="cb26-4" title="4"><span class="co">## [1] TRUE</span></a></code></pre></div>
</div>
<div id="dbConnect" class="section level3 hasAnchor">
<h3><span class="header-section-number">2.1.2</span> <code>dbConnect()</code><a href="#dbConnect" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Creates a connection to a DBMS.</li>
<li>Retruns S4 object (that inherits from DBIConnection virtual class), which holds the established connection information used to communicate with database.</li>
<li>Many connection variables can exist at the same time without affecting each other.</li>
</ul>
<p>The following example shows a typical argument list for connecting to Postgres.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" title="1">con &lt;-<span class="st"> </span>DBI<span class="op">::</span><span class="kw">dbConnect</span>(</a>
<a class="sourceLine" id="cb27-2" title="2">    <span class="dt">drv =</span> RPostgres<span class="op">::</span><span class="kw">Postgres</span>(),</a>
<a class="sourceLine" id="cb27-3" title="3">    <span class="dt">host =</span> <span class="st">&quot;localhost&quot;</span>,</a>
<a class="sourceLine" id="cb27-4" title="4">    <span class="dt">port =</span> <span class="dv">5432</span>,</a>
<a class="sourceLine" id="cb27-5" title="5">    <span class="dt">dbname =</span> <span class="st">&quot;your-database-name&quot;</span>,</a>
<a class="sourceLine" id="cb27-6" title="6">    <span class="dt">user =</span> <span class="st">&quot;your-user&quot;</span>,</a>
<a class="sourceLine" id="cb27-7" title="7">    <span class="dt">password =</span> <span class="st">&quot;your-password&quot;</span></a>
<a class="sourceLine" id="cb27-8" title="8">)</a></code></pre></div>
<p>Be aware that this is a terrible way of connecting to a non-demo database because your credentials are completely revealed in a plain text. See <a href="https://db.rstudio.com/best-practices/managing-credentials">Securing Credentials</a> for some better ways. In this document, we issue connection variables by calling <code>issue_con</code> defined in <a href="#Functions-dbi">2</a>.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" title="1">con &lt;-<span class="st"> </span><span class="kw">issue_con</span>(<span class="st">&quot;demo&quot;</span>)</a>
<a class="sourceLine" id="cb28-2" title="2">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">class</span>()</a>
<a class="sourceLine" id="cb28-3" title="3"><span class="co">## [1] &quot;PqConnection&quot;</span></a>
<a class="sourceLine" id="cb28-4" title="4"><span class="co">## attr(,&quot;package&quot;)</span></a>
<a class="sourceLine" id="cb28-5" title="5"><span class="co">## [1] &quot;RPostgres&quot;</span></a>
<a class="sourceLine" id="cb28-6" title="6">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mode</span>()</a>
<a class="sourceLine" id="cb28-7" title="7"><span class="co">## [1] &quot;S4&quot;</span></a>
<a class="sourceLine" id="cb28-8" title="8">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">typeof</span>()</a>
<a class="sourceLine" id="cb28-9" title="9"><span class="co">## [1] &quot;S4&quot;</span></a>
<a class="sourceLine" id="cb28-10" title="10">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>()</a>
<a class="sourceLine" id="cb28-11" title="11"><span class="co">## &lt;PqConnection&gt; demo@localhost:5432</span></a></code></pre></div>
</div>
<div id="dbdisconnect" class="section level3 hasAnchor">
<h3><span class="header-section-number">2.1.3</span> <code>dbDisconnect()</code><a href="#dbdisconnect" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Closes the associated connection, discards all associated pending work, and frees resources.</li>
<li>Retruns <code>TRUE</code> invisibly.</li>
<li>Issues warning on an already disconnected connnectinon variable or invalid one.</li>
<li>NOT clears a supplied connection object.</li>
</ul>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" title="1"><span class="co"># disconnect con varibale. returns nothing.</span></a>
<a class="sourceLine" id="cb29-2" title="2">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbDisconnect</span>()</a>
<a class="sourceLine" id="cb29-3" title="3"><span class="co"># get warned since con is already disconnected</span></a>
<a class="sourceLine" id="cb29-4" title="4">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbDisconnect</span>()</a>
<a class="sourceLine" id="cb29-5" title="5"><span class="co">## Warning in connection_release(conn@ptr): Already disconnected</span></a></code></pre></div>
<p>A disconnected object continues to exist as a non-null object.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" title="1">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">is.null</span>()</a>
<a class="sourceLine" id="cb30-2" title="2"><span class="co">## [1] FALSE</span></a>
<a class="sourceLine" id="cb30-3" title="3">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">class</span>()</a>
<a class="sourceLine" id="cb30-4" title="4"><span class="co">## [1] &quot;PqConnection&quot;</span></a>
<a class="sourceLine" id="cb30-5" title="5"><span class="co">## attr(,&quot;package&quot;)</span></a>
<a class="sourceLine" id="cb30-6" title="6"><span class="co">## [1] &quot;RPostgres&quot;</span></a></code></pre></div>
<p>But it is no longer printable.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" title="1">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>()</a>
<a class="sourceLine" id="cb31-2" title="2"><span class="co">## Error: Invalid connection</span></a></code></pre></div>
<p>Disconnection has a local effect. That is, disconnecting one connection has no impact on other connections.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" title="1">con &lt;-<span class="st"> </span><span class="kw">issue_con</span>(<span class="st">&quot;demo&quot;</span>)</a>
<a class="sourceLine" id="cb32-2" title="2">con1 &lt;-<span class="st"> </span><span class="kw">issue_con</span>(<span class="st">&quot;demo&quot;</span>)</a>
<a class="sourceLine" id="cb32-3" title="3">con1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbDisconnect</span>()</a>
<a class="sourceLine" id="cb32-4" title="4"><span class="co"># con is still valid</span></a>
<a class="sourceLine" id="cb32-5" title="5">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>()</a>
<a class="sourceLine" id="cb32-6" title="6"><span class="co">## &lt;PqConnection&gt; demo@localhost:5432</span></a></code></pre></div>
</div>
<div id="dbgetinfo" class="section level3 hasAnchor">
<h3><span class="header-section-number">2.1.4</span> <code>dbGetInfo()</code><a href="#dbgetinfo" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Retrieves information on database objects, i.e., DBIDriver (e.g., <code>RPostgres::Postgres</code>), DBIConnection (e.g., <code>con</code>) or DBIResult (e.g., <code>dbSendQuery()</code>).</li>
<li>Returns a named list whose components depend on the input class.</li>
</ul>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" title="1"><span class="kw">dbGetInfo</span>(RPostgres<span class="op">::</span><span class="kw">Postgres</span>())</a>
<a class="sourceLine" id="cb33-2" title="2"><span class="co">## $driver.version</span></a>
<a class="sourceLine" id="cb33-3" title="3"><span class="co">## [1] &#39;1.4.4.9000&#39;</span></a>
<a class="sourceLine" id="cb33-4" title="4"><span class="co">## </span></a>
<a class="sourceLine" id="cb33-5" title="5"><span class="co">## $client.version</span></a>
<a class="sourceLine" id="cb33-6" title="6"><span class="co">## [1] &#39;12.11&#39;</span></a>
<a class="sourceLine" id="cb33-7" title="7">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbGetInfo</span>()</a>
<a class="sourceLine" id="cb33-8" title="8"><span class="co">## $dbname</span></a>
<a class="sourceLine" id="cb33-9" title="9"><span class="co">## [1] &quot;demo&quot;</span></a>
<a class="sourceLine" id="cb33-10" title="10"><span class="co">## </span></a>
<a class="sourceLine" id="cb33-11" title="11"><span class="co">## $host</span></a>
<a class="sourceLine" id="cb33-12" title="12"><span class="co">## [1] &quot;localhost&quot;</span></a>
<a class="sourceLine" id="cb33-13" title="13"><span class="co">## </span></a>
<a class="sourceLine" id="cb33-14" title="14"><span class="co">## $port</span></a>
<a class="sourceLine" id="cb33-15" title="15"><span class="co">## [1] &quot;5432&quot;</span></a>
<a class="sourceLine" id="cb33-16" title="16"><span class="co">## </span></a>
<a class="sourceLine" id="cb33-17" title="17"><span class="co">## $username</span></a>
<a class="sourceLine" id="cb33-18" title="18"><span class="co">## [1] &quot;guest&quot;</span></a>
<a class="sourceLine" id="cb33-19" title="19"><span class="co">## </span></a>
<a class="sourceLine" id="cb33-20" title="20"><span class="co">## $protocol.version</span></a>
<a class="sourceLine" id="cb33-21" title="21"><span class="co">## [1] 3</span></a>
<a class="sourceLine" id="cb33-22" title="22"><span class="co">## </span></a>
<a class="sourceLine" id="cb33-23" title="23"><span class="co">## $server.version</span></a>
<a class="sourceLine" id="cb33-24" title="24"><span class="co">## [1] 120011</span></a>
<a class="sourceLine" id="cb33-25" title="25"><span class="co">## </span></a>
<a class="sourceLine" id="cb33-26" title="26"><span class="co">## $db.version</span></a>
<a class="sourceLine" id="cb33-27" title="27"><span class="co">## [1] 120011</span></a>
<a class="sourceLine" id="cb33-28" title="28"><span class="co">## </span></a>
<a class="sourceLine" id="cb33-29" title="29"><span class="co">## $pid</span></a>
<a class="sourceLine" id="cb33-30" title="30"><span class="co">## [1] 20334</span></a></code></pre></div>
</div>
<div id="dbisreadonly" class="section level3 hasAnchor">
<h3><span class="header-section-number">2.1.5</span> <code>dbIsReadOnly()</code><a href="#dbisreadonly" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Tests whether a database object is read only.</li>
<li>Returns logical.</li>
</ul>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" title="1">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbIsReadOnly</span>()</a>
<a class="sourceLine" id="cb34-2" title="2"><span class="co">## [1] FALSE</span></a>
<a class="sourceLine" id="cb34-3" title="3"><span class="kw">dbIsReadOnly</span>(RPostgres<span class="op">::</span><span class="kw">Postgres</span>())</a>
<a class="sourceLine" id="cb34-4" title="4"><span class="co">## [1] FALSE</span></a></code></pre></div>

</div>
</div>
<div id="manipulating-tables" class="section level2 hasAnchor">
<h2><span class="header-section-number">2.2</span> Manipulating Tables<a href="#manipulating-tables" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="dbreadtable" class="section level3 hasAnchor">
<h3><span class="header-section-number">2.2.1</span> <code>dbReadTable()</code><a href="#dbreadtable" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Copy data frames from database tables.</li>
<li>Returns a data frame that contains the complete data from the remote table.</li>
</ul>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" title="1"><span class="co"># prepare a table to read</span></a>
<a class="sourceLine" id="cb35-2" title="2">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbWriteTable</span>(<span class="st">&quot;mtcars&quot;</span>, mtcars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(), <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb35-3" title="3"></a>
<a class="sourceLine" id="cb35-4" title="4">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbReadTable</span>(<span class="st">&quot;mtcars&quot;</span>)</a>
<a class="sourceLine" id="cb35-5" title="5"><span class="co">##    mpg cyl disp  hp drat    wt  qsec vs am gear carb</span></a>
<a class="sourceLine" id="cb35-6" title="6"><span class="co">## 1 21.0   6  160 110 3.90 2.620 16.46  0  1    4    4</span></a>
<a class="sourceLine" id="cb35-7" title="7"><span class="co">## 2 21.0   6  160 110 3.90 2.875 17.02  0  1    4    4</span></a>
<a class="sourceLine" id="cb35-8" title="8"><span class="co">## 3 22.8   4  108  93 3.85 2.320 18.61  1  1    4    1</span></a>
<a class="sourceLine" id="cb35-9" title="9"><span class="co">## 4 21.4   6  258 110 3.08 3.215 19.44  1  0    3    1</span></a>
<a class="sourceLine" id="cb35-10" title="10"><span class="co">## 5 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2</span></a>
<a class="sourceLine" id="cb35-11" title="11"><span class="co">## 6 18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</span></a></code></pre></div>
</div>
<div id="dbwritetable" class="section level3 hasAnchor">
<h3><span class="header-section-number">2.2.2</span> <code>dbWriteTable()</code><a href="#dbwritetable" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Writes, overwrites or appends a data frame to a database table.</li>
<li>Returns <code>TRUE</code> invisibly.</li>
<li>Various optional argumets (must be provided as named arguments) available such as
<ul>
<li><code>temoprary = FALSE</code>: a logical specifying whether a created table should be temoprary in the sense that it vanishes after disconection. <strong>NOT available with postgres</strong>.</li>
<li><code>overwrite = FALSE</code>: a logical specifying whether to overwrite an existing table.</li>
<li><code>append = FALSE</code>: a logical specifying whether to append to an existing table.</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" title="1"><span class="co"># clear an old table, if exists</span></a>
<a class="sourceLine" id="cb36-2" title="2">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbRemoveTable</span>(<span class="st">&quot;mtcars&quot;</span>, <span class="dt">fail_if_missing =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb36-3" title="3"></a>
<a class="sourceLine" id="cb36-4" title="4"><span class="co"># create a new table</span></a>
<a class="sourceLine" id="cb36-5" title="5">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbWriteTable</span>(<span class="dt">name =</span> <span class="st">&quot;mtcars&quot;</span>, <span class="dt">value =</span> mtcars[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, ])</a>
<a class="sourceLine" id="cb36-6" title="6">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbReadTable</span>(<span class="st">&quot;mtcars&quot;</span>)</a>
<a class="sourceLine" id="cb36-7" title="7"><span class="co">##   mpg cyl disp  hp drat    wt  qsec vs am gear carb</span></a>
<a class="sourceLine" id="cb36-8" title="8"><span class="co">## 1  21   6  160 110  3.9 2.620 16.46  0  1    4    4</span></a>
<a class="sourceLine" id="cb36-9" title="9"><span class="co">## 2  21   6  160 110  3.9 2.875 17.02  0  1    4    4</span></a>
<a class="sourceLine" id="cb36-10" title="10"></a>
<a class="sourceLine" id="cb36-11" title="11"><span class="co"># append rows to an exsiting table</span></a>
<a class="sourceLine" id="cb36-12" title="12">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbWriteTable</span>(<span class="dt">name =</span> <span class="st">&quot;mtcars&quot;</span>, <span class="dt">value =</span> mtcars[<span class="dv">3</span><span class="op">:</span><span class="dv">5</span>, ], <span class="dt">append =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb36-13" title="13">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbReadTable</span>(<span class="st">&quot;mtcars&quot;</span>)</a>
<a class="sourceLine" id="cb36-14" title="14"><span class="co">##    mpg cyl disp  hp drat    wt  qsec vs am gear carb</span></a>
<a class="sourceLine" id="cb36-15" title="15"><span class="co">## 1 21.0   6  160 110 3.90 2.620 16.46  0  1    4    4</span></a>
<a class="sourceLine" id="cb36-16" title="16"><span class="co">## 2 21.0   6  160 110 3.90 2.875 17.02  0  1    4    4</span></a>
<a class="sourceLine" id="cb36-17" title="17"><span class="co">## 3 22.8   4  108  93 3.85 2.320 18.61  1  1    4    1</span></a>
<a class="sourceLine" id="cb36-18" title="18"><span class="co">## 4 21.4   6  258 110 3.08 3.215 19.44  1  0    3    1</span></a>
<a class="sourceLine" id="cb36-19" title="19"><span class="co">## 5 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2</span></a>
<a class="sourceLine" id="cb36-20" title="20"></a>
<a class="sourceLine" id="cb36-21" title="21"><span class="co"># overwrite an existing table</span></a>
<a class="sourceLine" id="cb36-22" title="22">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbWriteTable</span>(<span class="dt">name =</span> <span class="st">&quot;mtcars&quot;</span>, <span class="dt">value =</span> mtcars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tail</span>(), <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb36-23" title="23">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbReadTable</span>(<span class="st">&quot;mtcars&quot;</span>)</a>
<a class="sourceLine" id="cb36-24" title="24"><span class="co">##    mpg cyl  disp  hp drat    wt qsec vs am gear carb</span></a>
<a class="sourceLine" id="cb36-25" title="25"><span class="co">## 1 26.0   4 120.3  91 4.43 2.140 16.7  0  1    5    2</span></a>
<a class="sourceLine" id="cb36-26" title="26"><span class="co">## 2 30.4   4  95.1 113 3.77 1.513 16.9  1  1    5    2</span></a>
<a class="sourceLine" id="cb36-27" title="27"><span class="co">## 3 15.8   8 351.0 264 4.22 3.170 14.5  0  1    5    4</span></a>
<a class="sourceLine" id="cb36-28" title="28"><span class="co">## 4 19.7   6 145.0 175 3.62 2.770 15.5  0  1    5    6</span></a>
<a class="sourceLine" id="cb36-29" title="29"><span class="co">## 5 15.0   8 301.0 335 3.54 3.570 14.6  0  1    5    8</span></a>
<a class="sourceLine" id="cb36-30" title="30"><span class="co">## 6 21.4   4 121.0 109 4.11 2.780 18.6  1  1    4    2</span></a></code></pre></div>
<p>The following example demonstrates that <code>DBI::dbWriteTable()</code> does not accept <code>temoprary =</code> option. Note that no error or warnig is raised. The same is true for <code>Postgres::dbWriteTable()</code>.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" title="1"><span class="co"># temprary = TRUE is available?</span></a>
<a class="sourceLine" id="cb37-2" title="2">con <span class="op">%&gt;%</span><span class="st"> </span>RPostgres<span class="op">::</span><span class="kw">dbWriteTable</span>(<span class="st">&quot;mtcars&quot;</span>, mtcars, <span class="dt">overwrite =</span> <span class="ot">TRUE</span>, <span class="dt">temoprary =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb37-3" title="3"></a>
<a class="sourceLine" id="cb37-4" title="4"><span class="co"># show list of tables currently available</span></a>
<a class="sourceLine" id="cb37-5" title="5">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbListTables</span>()</a>
<a class="sourceLine" id="cb37-6" title="6"><span class="co">## [1] &quot;mtcars&quot;</span></a>
<a class="sourceLine" id="cb37-7" title="7"></a>
<a class="sourceLine" id="cb37-8" title="8"><span class="co"># refresh connnection</span></a>
<a class="sourceLine" id="cb37-9" title="9">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbDisconnect</span>()</a>
<a class="sourceLine" id="cb37-10" title="10">con &lt;-<span class="st"> </span><span class="kw">issue_con</span>(<span class="st">&quot;demo&quot;</span>)</a>
<a class="sourceLine" id="cb37-11" title="11"></a>
<a class="sourceLine" id="cb37-12" title="12"><span class="co"># is the table still alive? -&gt; yes</span></a>
<a class="sourceLine" id="cb37-13" title="13">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbListTables</span>()</a>
<a class="sourceLine" id="cb37-14" title="14"><span class="co">## [1] &quot;mtcars&quot;</span></a></code></pre></div>
</div>
<div id="dbappendtable" class="section level3 hasAnchor">
<h3><span class="header-section-number">2.2.3</span> <code>dbAppendTable()</code><a href="#dbappendtable" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Inserts rows into a table, assuming that the table has been created beforehand.</li>
<li>Returns a scalar numeric equal to the number of rows inserted.</li>
<li>The <code>row.names</code> argument must be <code>NULL</code>, the default value. The row names of input data are ignored.</li>
<li>In Postgres, <code>DBI::dbAppendTable()</code> is overrideen by <code>RPostgres::dbAppendTable()</code> because RPostgres uses placeholders of the form <code>$1</code>, <code>$2</code> etc. instead of <code>?</code>.</li>
</ul>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" title="1"><span class="co"># create demo table</span></a>
<a class="sourceLine" id="cb38-2" title="2">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbWriteTable</span>(<span class="st">&quot;mtcars&quot;</span>, mtcars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">2</span>), <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb38-3" title="3"><span class="co"># insert 10 rows from tail</span></a>
<a class="sourceLine" id="cb38-4" title="4">con <span class="op">%&gt;%</span><span class="st"> </span>DBI<span class="op">::</span><span class="kw">dbAppendTable</span>(<span class="dt">name =</span> <span class="st">&quot;mtcars&quot;</span>, <span class="dt">value =</span> mtcars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tail</span>(<span class="dv">10</span>))</a>
<a class="sourceLine" id="cb38-5" title="5"><span class="co">## [1] 10</span></a>
<a class="sourceLine" id="cb38-6" title="6"><span class="co"># show resulting table</span></a>
<a class="sourceLine" id="cb38-7" title="7">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbReadTable</span>(<span class="st">&quot;mtcars&quot;</span>)</a>
<a class="sourceLine" id="cb38-8" title="8"><span class="co">##     mpg cyl  disp  hp drat    wt  qsec vs am gear carb</span></a>
<a class="sourceLine" id="cb38-9" title="9"><span class="co">## 1  21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4</span></a>
<a class="sourceLine" id="cb38-10" title="10"><span class="co">## 2  21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4</span></a>
<a class="sourceLine" id="cb38-11" title="11"><span class="co">## 3  15.2   8 304.0 150 3.15 3.435 17.30  0  0    3    2</span></a>
<a class="sourceLine" id="cb38-12" title="12"><span class="co">## 4  13.3   8 350.0 245 3.73 3.840 15.41  0  0    3    4</span></a>
<a class="sourceLine" id="cb38-13" title="13"><span class="co">## 5  19.2   8 400.0 175 3.08 3.845 17.05  0  0    3    2</span></a>
<a class="sourceLine" id="cb38-14" title="14"><span class="co">## 6  27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1</span></a>
<a class="sourceLine" id="cb38-15" title="15"><span class="co">## 7  26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2</span></a>
<a class="sourceLine" id="cb38-16" title="16"><span class="co">## 8  30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2</span></a>
<a class="sourceLine" id="cb38-17" title="17"><span class="co">## 9  15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4</span></a>
<a class="sourceLine" id="cb38-18" title="18"><span class="co">## 10 19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6</span></a>
<a class="sourceLine" id="cb38-19" title="19"><span class="co">## 11 15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8</span></a>
<a class="sourceLine" id="cb38-20" title="20"><span class="co">## 12 21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2</span></a></code></pre></div>
<p>Appending rows into an absent table raises an error.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" title="1">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbAppendTable</span>(<span class="st">&quot;iris&quot;</span>, iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>())</a>
<a class="sourceLine" id="cb39-2" title="2"><span class="co">## Error: Failed to initialise COPY: ERROR:  relation &quot;iris&quot; does not exist</span></a></code></pre></div>
</div>
<div id="dbremovetable" class="section level3 hasAnchor">
<h3><span class="header-section-number">2.2.4</span> <code>dbRemoveTable()</code><a href="#dbremovetable" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Removes a remote table from the database.</li>
<li>Returns <code>TRUE</code> invisibly.</li>
<li>Raises an error if the intended table does not exist (see <code>fail_if_missing</code> option below).</li>
<li>Cannot remove a view in postges. (Neither DBI nor RPostgres has a method for dropping a view. It must be crafted by the user.)</li>
<li>Additional options, which must be called as named ones, include
<ul>
<li><code>temoprary = FALSE</code>: a logical specifying whether to consider only temprary tables. <strong>NOT available with postgres</strong>.</li>
<li><code>fail_if_missing = TRUE</code>: a logical specifying whether to raise an error for the call to remove an absent table.</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" title="1"><span class="cf">if</span> (con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbExistsTable</span>(<span class="st">&quot;mtcars&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">isFALSE</span>()) {</a>
<a class="sourceLine" id="cb40-2" title="2">    con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbWriteTable</span>(<span class="st">&quot;mtcars&quot;</span>, mtcars)</a>
<a class="sourceLine" id="cb40-3" title="3">}</a>
<a class="sourceLine" id="cb40-4" title="4"></a>
<a class="sourceLine" id="cb40-5" title="5">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbListTables</span>()</a>
<a class="sourceLine" id="cb40-6" title="6"><span class="co">## [1] &quot;mtcars&quot;</span></a>
<a class="sourceLine" id="cb40-7" title="7">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbRemoveTable</span>(<span class="st">&quot;mtcars&quot;</span>) <span class="co"># remove here</span></a>
<a class="sourceLine" id="cb40-8" title="8">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbListTables</span>() <span class="co"># removed table no longer exists</span></a>
<a class="sourceLine" id="cb40-9" title="9"><span class="co">## character(0)</span></a></code></pre></div>
<p>In Postgres, <code>temporary = TRUE</code> causes an error regardless of the existanece of the table.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" title="1"><span class="cf">if</span> (con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbExistsTable</span>(<span class="st">&quot;mtcars&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">isFALSE</span>()) {</a>
<a class="sourceLine" id="cb41-2" title="2">    con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbWriteTable</span>(<span class="st">&quot;mtcars&quot;</span>, mtcars)</a>
<a class="sourceLine" id="cb41-3" title="3">}</a>
<a class="sourceLine" id="cb41-4" title="4">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbRemoveTable</span>(<span class="st">&quot;mtcars&quot;</span>, <span class="dt">temporary =</span> <span class="ot">TRUE</span>) <span class="co"># error</span></a>
<a class="sourceLine" id="cb41-5" title="5"><span class="co">## Error: Failed to fetch row: ERROR:  schema &quot;pg_temp&quot; does not exist</span></a></code></pre></div>
<p>In this case, the asked removal will not be executed.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" title="1">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbListTables</span>() <span class="co"># the table is still alive</span></a>
<a class="sourceLine" id="cb42-2" title="2"><span class="co">## [1] &quot;mtcars&quot;</span></a></code></pre></div>
<p>The following examples illustrate the behaviour of the option <code>fail_if_missing =</code>.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" title="1"><span class="co"># fail_if_missing = FALSE makes an otherwise invalid call valid</span></a>
<a class="sourceLine" id="cb43-2" title="2">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbRemoveTable</span>(<span class="st">&quot;absent_table&quot;</span>, <span class="dt">fail_if_missing =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb43-3" title="3"><span class="co">## </span><span class="al">NOTICE</span><span class="co">:  table &quot;absent_table&quot; does not exist, skipping</span></a></code></pre></div>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" title="1"><span class="co"># fail_if_missing = TRUE, the default, raises an error for deleting an absent table</span></a>
<a class="sourceLine" id="cb44-2" title="2">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbRemoveTable</span>(<span class="st">&quot;absent_table&quot;</span>)</a>
<a class="sourceLine" id="cb44-3" title="3"><span class="co">## Error: Failed to fetch row: ERROR:  table &quot;absent_table&quot; does not exist</span></a></code></pre></div>
</div>
<div id="dblisttables" class="section level3 hasAnchor">
<h3><span class="header-section-number">2.2.5</span> <code>dbListTables()</code><a href="#dblisttables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Returns a character vector that enumerates all tables and views in the database.</li>
<li>In Postgres, this includes views and temprary objects created by <code>dplyr::copy_to()</code>, but not those by <code>dbplyr::copy_inline()</code>.</li>
</ul>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" title="1"><span class="co"># prepare a table to list</span></a>
<a class="sourceLine" id="cb45-2" title="2">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbWriteTable</span>(<span class="st">&quot;mtcars&quot;</span>, mtcars, <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb45-3" title="3">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbWriteTable</span>(<span class="st">&quot;iris&quot;</span>, iris, <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb45-4" title="4"></a>
<a class="sourceLine" id="cb45-5" title="5">lt &lt;-<span class="st"> </span>con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbListTables</span>()</a>
<a class="sourceLine" id="cb45-6" title="6">lt <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">class</span>()</a>
<a class="sourceLine" id="cb45-7" title="7"><span class="co">## [1] &quot;character&quot;</span></a>
<a class="sourceLine" id="cb45-8" title="8">lt <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mode</span>()</a>
<a class="sourceLine" id="cb45-9" title="9"><span class="co">## [1] &quot;character&quot;</span></a>
<a class="sourceLine" id="cb45-10" title="10">lt <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">typeof</span>()</a>
<a class="sourceLine" id="cb45-11" title="11"><span class="co">## [1] &quot;character&quot;</span></a>
<a class="sourceLine" id="cb45-12" title="12">lt <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>()</a>
<a class="sourceLine" id="cb45-13" title="13"><span class="co">## [1] &quot;mtcars&quot; &quot;iris&quot;</span></a></code></pre></div>
</div>
<div id="dblistfields" class="section level3 hasAnchor">
<h3><span class="header-section-number">2.2.6</span> <code>dbListFields()</code><a href="#dblistfields" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Returns a character vector that enumerates all fields in the table in the correct order.</li>
<li>Works also for temprary tables created by <code>dplyr::copy_to()</code> in Postgres.</li>
</ul>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" title="1">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbListFields</span>(<span class="st">&quot;mtcars&quot;</span>)</a>
<a class="sourceLine" id="cb46-2" title="2"><span class="co">##  [1] &quot;mpg&quot;  &quot;cyl&quot;  &quot;disp&quot; &quot;hp&quot;   &quot;drat&quot; &quot;wt&quot;   &quot;qsec&quot; &quot;vs&quot;   &quot;am&quot;   &quot;gear&quot;</span></a>
<a class="sourceLine" id="cb46-3" title="3"><span class="co">## [11] &quot;carb&quot;</span></a></code></pre></div>
</div>
<div id="dbexiststable" class="section level3 hasAnchor">
<h3><span class="header-section-number">2.2.7</span> <code>dbExistsTable()</code><a href="#dbexiststable" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Returns a logical scalar, <code>TRUE</code> if the table or view specified by the name argument exists, <code>FALSE</code> otherwise.</li>
<li>Works also for temprary tables created by <code>dplyr::copy_to()</code> in Postgres.</li>
</ul>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" title="1">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbExistsTable</span>(<span class="st">&quot;mtcars&quot;</span>)</a>
<a class="sourceLine" id="cb47-2" title="2"><span class="co">## [1] TRUE</span></a>
<a class="sourceLine" id="cb47-3" title="3">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbExistsTable</span>(<span class="st">&quot;absent_table&quot;</span>)</a>
<a class="sourceLine" id="cb47-4" title="4"><span class="co">## [1] FALSE</span></a></code></pre></div>
</div>
<div id="dblistobjects" class="section level3 hasAnchor">
<h3><span class="header-section-number">2.2.8</span> <code>dbListObjects()</code><a href="#dblistobjects" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Returns a data frame with columns table and is_prefix in that order.</li>
<li>Works also for temprary tables created by <code>dplyr::copy_to()</code> in Postgres.</li>
</ul>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" title="1"><span class="co"># prepare a table to list</span></a>
<a class="sourceLine" id="cb48-2" title="2">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbWriteTable</span>(<span class="st">&quot;mtcars&quot;</span>, mtcars, <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb48-3" title="3">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbWriteTable</span>(<span class="st">&quot;iris&quot;</span>, iris, <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb48-4" title="4"></a>
<a class="sourceLine" id="cb48-5" title="5">objs &lt;-<span class="st"> </span>con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbListObjects</span>()</a>
<a class="sourceLine" id="cb48-6" title="6">objs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">class</span>()</a>
<a class="sourceLine" id="cb48-7" title="7"><span class="co">## [1] &quot;data.frame&quot;</span></a>
<a class="sourceLine" id="cb48-8" title="8">objs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mode</span>()</a>
<a class="sourceLine" id="cb48-9" title="9"><span class="co">## [1] &quot;list&quot;</span></a>
<a class="sourceLine" id="cb48-10" title="10">objs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">typeof</span>()</a>
<a class="sourceLine" id="cb48-11" title="11"><span class="co">## [1] &quot;list&quot;</span></a>
<a class="sourceLine" id="cb48-12" title="12">objs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>()</a>
<a class="sourceLine" id="cb48-13" title="13"><span class="co">##                              table is_prefix</span></a>
<a class="sourceLine" id="cb48-14" title="14"><span class="co">## 1              &lt;Id&gt; table = mtcars     FALSE</span></a>
<a class="sourceLine" id="cb48-15" title="15"><span class="co">## 2                &lt;Id&gt; table = iris     FALSE</span></a>
<a class="sourceLine" id="cb48-16" title="16"><span class="co">## 3             &lt;Id&gt; schema = public      TRUE</span></a>
<a class="sourceLine" id="cb48-17" title="17"><span class="co">## 4 &lt;Id&gt; schema = information_schema      TRUE</span></a>
<a class="sourceLine" id="cb48-18" title="18"><span class="co">## 5         &lt;Id&gt; schema = pg_catalog      TRUE</span></a></code></pre></div>

</div>
</div>
<div id="queries-and-statements" class="section level2 hasAnchor">
<h2><span class="header-section-number">2.3</span> Queries and Statements<a href="#queries-and-statements" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This section uses the following tables as an example.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" title="1">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbWriteTable</span>(<span class="st">&quot;mtcars&quot;</span>, mtcars, <span class="dt">overwirte =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb49-2" title="2">con <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb49-3" title="3"><span class="st">    </span><span class="kw">dbReadTable</span>(<span class="st">&quot;mtcars&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb49-4" title="4"><span class="st">    </span><span class="kw">head</span>()</a>
<a class="sourceLine" id="cb49-5" title="5"><span class="co">##    mpg cyl disp  hp drat    wt  qsec vs am gear carb</span></a>
<a class="sourceLine" id="cb49-6" title="6"><span class="co">## 1 21.0   6  160 110 3.90 2.620 16.46  0  1    4    4</span></a>
<a class="sourceLine" id="cb49-7" title="7"><span class="co">## 2 21.0   6  160 110 3.90 2.875 17.02  0  1    4    4</span></a>
<a class="sourceLine" id="cb49-8" title="8"><span class="co">## 3 22.8   4  108  93 3.85 2.320 18.61  1  1    4    1</span></a>
<a class="sourceLine" id="cb49-9" title="9"><span class="co">## 4 21.4   6  258 110 3.08 3.215 19.44  1  0    3    1</span></a>
<a class="sourceLine" id="cb49-10" title="10"><span class="co">## 5 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2</span></a>
<a class="sourceLine" id="cb49-11" title="11"><span class="co">## 6 18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</span></a></code></pre></div>
<div id="dbgetquery" class="section level3 hasAnchor">
<h3><span class="header-section-number">2.3.1</span> <code>dbGetQuery()</code><a href="#dbgetquery" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Executes a <code>SELECT</code> query written as a string.</li>
<li>Returns the result, which is not stored as a result set contrary to <code>dbSendQuery()</code>.</li>
<li>Comes with a default implementation that calls <code>dbSendQuery()</code> -&gt; <code>dbFetch()</code> -&gt; <code>dbClearResult()</code>.</li>
<li>Returns a dataframe even if no rows are returned.</li>
<li>Additional arguments
<ul>
<li><code>n = -1</code>: specifies the number of rows to be fetched. <code>n = Inf</code> gives you the full result, <code>n = 0</code> the fully typed columns.</li>
<li><code>param</code>: allows passing query parameters, see <code>dbBind()</code> for details.</li>
<li><code>immediate</code>: see official reference.</li>
</ul></li>
</ul>
<p>You don’t have to add <code>;</code> at the end of the query.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" title="1">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbGetQuery</span>(<span class="st">&quot;SELECT * FROM mtcars WHERE cyl &gt;= 5&quot;</span>, <span class="dt">n =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb50-2" title="2"><span class="co">##    mpg cyl disp  hp drat    wt  qsec vs am gear carb</span></a>
<a class="sourceLine" id="cb50-3" title="3"><span class="co">## 1 21.0   6  160 110 3.90 2.620 16.46  0  1    4    4</span></a>
<a class="sourceLine" id="cb50-4" title="4"><span class="co">## 2 21.0   6  160 110 3.90 2.875 17.02  0  1    4    4</span></a>
<a class="sourceLine" id="cb50-5" title="5"><span class="co">## 3 21.4   6  258 110 3.08 3.215 19.44  1  0    3    1</span></a>
<a class="sourceLine" id="cb50-6" title="6"><span class="co">## 4 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2</span></a>
<a class="sourceLine" id="cb50-7" title="7"><span class="co">## 5 18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</span></a></code></pre></div>
<p>Sclar values in a query can be parameterized.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" title="1">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbGetQuery</span>(</a>
<a class="sourceLine" id="cb51-2" title="2">    <span class="st">&quot;SELECT * FROM mtcars WHERE cyl = $1&quot;</span>,</a>
<a class="sourceLine" id="cb51-3" title="3">    <span class="dt">params =</span> <span class="kw">list</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>),</a>
<a class="sourceLine" id="cb51-4" title="4">    <span class="dt">n =</span> <span class="dv">5</span></a>
<a class="sourceLine" id="cb51-5" title="5">)</a>
<a class="sourceLine" id="cb51-6" title="6"><span class="co">##    mpg cyl  disp hp drat    wt  qsec vs am gear carb</span></a>
<a class="sourceLine" id="cb51-7" title="7"><span class="co">## 1 22.8   4 108.0 93 3.85 2.320 18.61  1  1    4    1</span></a>
<a class="sourceLine" id="cb51-8" title="8"><span class="co">## 2 24.4   4 146.7 62 3.69 3.190 20.00  1  0    4    2</span></a>
<a class="sourceLine" id="cb51-9" title="9"><span class="co">## 3 22.8   4 140.8 95 3.92 3.150 22.90  1  0    4    2</span></a>
<a class="sourceLine" id="cb51-10" title="10"><span class="co">## 4 32.4   4  78.7 66 4.08 2.200 19.47  1  1    4    1</span></a>
<a class="sourceLine" id="cb51-11" title="11"><span class="co">## 5 30.4   4  75.7 52 4.93 1.615 18.52  1  1    4    2</span></a></code></pre></div>
<p><code>dbGetQuery()</code> rejects multiple queries.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" title="1">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbGetQuery</span>(<span class="st">&quot;SELECT * FROM mtcars WHERE cyl &gt;= 5; SELECT 3.14 AS pi&quot;</span>)</a>
<a class="sourceLine" id="cb52-2" title="2"><span class="co">## Error: Failed to prepare query: ERROR:  cannot insert multiple commands into a prepared statement</span></a></code></pre></div>
</div>
<div id="dbexecute" class="section level3 hasAnchor">
<h3><span class="header-section-number">2.3.2</span> <code>dbExecute()</code><a href="#dbexecute" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Executes a statement. The result is not stored as a result set.</li>
<li>Returns the number of rows affected.</li>
<li>Comes with a default implementation that calls <code>dbSendStatement()</code> -&gt; <code>dbGetRowsAffected()</code> -&gt; <code>dbClearResult()</code>.</li>
<li>Additional arguments <code>params</code> and <code>immediate</code> are available as in <code>dbGetQuery()</code>.</li>
</ul>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" title="1"><span class="co"># newly create cars table</span></a>
<a class="sourceLine" id="cb53-2" title="2">con <span class="op">%&gt;%</span><span class="st"> </span>DBI<span class="op">::</span><span class="kw">dbWriteTable</span>(<span class="st">&quot;cars&quot;</span>, cars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">1</span>), <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb53-3" title="3">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbReadTable</span>(<span class="st">&quot;cars&quot;</span>) <span class="co"># only 1 row</span></a>
<a class="sourceLine" id="cb53-4" title="4"><span class="co">##   speed dist</span></a>
<a class="sourceLine" id="cb53-5" title="5"><span class="co">## 1     4    2</span></a>
<a class="sourceLine" id="cb53-6" title="6"></a>
<a class="sourceLine" id="cb53-7" title="7">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbExecute</span>(</a>
<a class="sourceLine" id="cb53-8" title="8">    <span class="st">&quot;INSERT INTO cars (speed, dist) VALUES ($1, $2)&quot;</span>,</a>
<a class="sourceLine" id="cb53-9" title="9">    <span class="dt">params =</span> <span class="kw">list</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dv">6</span><span class="op">:</span><span class="dv">9</span>)</a>
<a class="sourceLine" id="cb53-10" title="10">)</a>
<a class="sourceLine" id="cb53-11" title="11"><span class="co">## [1] 4</span></a>
<a class="sourceLine" id="cb53-12" title="12">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbReadTable</span>(<span class="st">&quot;cars&quot;</span>) <span class="co"># rows added</span></a>
<a class="sourceLine" id="cb53-13" title="13"><span class="co">##   speed dist</span></a>
<a class="sourceLine" id="cb53-14" title="14"><span class="co">## 1     4    2</span></a>
<a class="sourceLine" id="cb53-15" title="15"><span class="co">## 2     1    6</span></a>
<a class="sourceLine" id="cb53-16" title="16"><span class="co">## 3     2    7</span></a>
<a class="sourceLine" id="cb53-17" title="17"><span class="co">## 4     3    8</span></a>
<a class="sourceLine" id="cb53-18" title="18"><span class="co">## 5     4    9</span></a></code></pre></div>
<p><code>dbExecute()</code> rejects multiple statements.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" title="1">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbExecute</span>(<span class="st">&quot;INSERT INTO cars (speed, dist) VALUES (7,21); DROP TABLE cars&quot;</span>)</a>
<a class="sourceLine" id="cb54-2" title="2"><span class="co">## Error: Failed to prepare query: ERROR:  cannot insert multiple commands into a prepared statement</span></a></code></pre></div>
</div>
<div id="dbsendquery" class="section level3 hasAnchor">
<h3><span class="header-section-number">2.3.3</span> <code>dbSendQuery()</code><a href="#dbsendquery" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Submits and synchronously executes the SQL query. Should be followed by <code>dbFetch()</code> and <code>dbClearResult()</code> to get and clear the pooled result. See <a href="https://dbi.r-dbi.org/reference/dbsendquery">The data retrieval flow section in official reference</a>.</li>
<li>Returns an S4 object that inherits from DBIResult, called a result set.</li>
<li>The returned result object should be stored in a variable.</li>
<li>Additional arguments <code>params</code> and <code>immediate</code>.</li>
</ul>
<p>Exactly the same parameterization method works as in <code>dbGetQuery()</code>.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" title="1">rs &lt;-<span class="st"> </span>con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbSendQuery</span>(</a>
<a class="sourceLine" id="cb55-2" title="2">    <span class="st">&quot;SELECT * FROM mtcars WHERE cyl = $1&quot;</span>,</a>
<a class="sourceLine" id="cb55-3" title="3">    <span class="dt">params =</span> <span class="kw">list</span>(4L)</a>
<a class="sourceLine" id="cb55-4" title="4">)</a>
<a class="sourceLine" id="cb55-5" title="5">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbFetch</span>(<span class="dt">n =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb55-6" title="6"><span class="co">##    mpg cyl  disp hp drat    wt  qsec vs am gear carb</span></a>
<a class="sourceLine" id="cb55-7" title="7"><span class="co">## 1 22.8   4 108.0 93 3.85 2.320 18.61  1  1    4    1</span></a>
<a class="sourceLine" id="cb55-8" title="8"><span class="co">## 2 24.4   4 146.7 62 3.69 3.190 20.00  1  0    4    2</span></a>
<a class="sourceLine" id="cb55-9" title="9"><span class="co">## 3 22.8   4 140.8 95 3.92 3.150 22.90  1  0    4    2</span></a>
<a class="sourceLine" id="cb55-10" title="10"><span class="co">## 4 32.4   4  78.7 66 4.08 2.200 19.47  1  1    4    1</span></a>
<a class="sourceLine" id="cb55-11" title="11"><span class="co">## 5 30.4   4  75.7 52 4.93 1.615 18.52  1  1    4    2</span></a>
<a class="sourceLine" id="cb55-12" title="12">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbClearResult</span>()</a></code></pre></div>
<p><code>dbSendQuery()</code> gives us an alternative way of writing a parameterized query.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" title="1">rs &lt;-<span class="st"> </span>con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbSendQuery</span>(</a>
<a class="sourceLine" id="cb56-2" title="2">    <span class="st">&quot;SELECT * FROM mtcars WHERE cyl = $1&quot;</span></a>
<a class="sourceLine" id="cb56-3" title="3">)</a>
<a class="sourceLine" id="cb56-4" title="4">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbBind</span>(<span class="kw">list</span>(4L))</a>
<a class="sourceLine" id="cb56-5" title="5">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbFetch</span>(<span class="dt">n =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb56-6" title="6"><span class="co">##    mpg cyl  disp hp drat    wt  qsec vs am gear carb</span></a>
<a class="sourceLine" id="cb56-7" title="7"><span class="co">## 1 22.8   4 108.0 93 3.85 2.320 18.61  1  1    4    1</span></a>
<a class="sourceLine" id="cb56-8" title="8"><span class="co">## 2 24.4   4 146.7 62 3.69 3.190 20.00  1  0    4    2</span></a>
<a class="sourceLine" id="cb56-9" title="9"><span class="co">## 3 22.8   4 140.8 95 3.92 3.150 22.90  1  0    4    2</span></a>
<a class="sourceLine" id="cb56-10" title="10"><span class="co">## 4 32.4   4  78.7 66 4.08 2.200 19.47  1  1    4    1</span></a>
<a class="sourceLine" id="cb56-11" title="11"><span class="co">## 5 30.4   4  75.7 52 4.93 1.615 18.52  1  1    4    2</span></a>
<a class="sourceLine" id="cb56-12" title="12">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbClearResult</span>()</a></code></pre></div>
</div>
<div id="dbsendstatement" class="section level3 hasAnchor">
<h3><span class="header-section-number">2.3.4</span> <code>dbSendStatement()</code><a href="#dbsendstatement" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Submits and synchronously executes the SQL data manipulation statement (e.g., UPDATE, DELETE, INSERT INTO, DROP TABLE, …).</li>
<li>Returns a result object as in <code>dbSendQuery()</code>.</li>
<li>The returned result set should be stored in a variable.</li>
<li>A part of <code>dbExecute()</code>.</li>
<li>Additional arguments <code>params</code> and <code>immediate</code>.</li>
</ul>
<p>A typical parameterization through <code>params = list(...)</code> works.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" title="1"><span class="co"># overwirte cars table</span></a>
<a class="sourceLine" id="cb57-2" title="2">con <span class="op">%&gt;%</span><span class="st"> </span>DBI<span class="op">::</span><span class="kw">dbWriteTable</span>(<span class="st">&quot;cars&quot;</span>, cars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">1</span>), <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb57-3" title="3">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbReadTable</span>(<span class="st">&quot;cars&quot;</span>)</a>
<a class="sourceLine" id="cb57-4" title="4"><span class="co">##   speed dist</span></a>
<a class="sourceLine" id="cb57-5" title="5"><span class="co">## 1     4    2</span></a>
<a class="sourceLine" id="cb57-6" title="6"></a>
<a class="sourceLine" id="cb57-7" title="7"><span class="co"># insert statement with typical parameterization</span></a>
<a class="sourceLine" id="cb57-8" title="8">rs &lt;-<span class="st"> </span>con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbSendStatement</span>(</a>
<a class="sourceLine" id="cb57-9" title="9">    <span class="st">&quot;INSERT INTO cars (speed, dist) VALUES ($1, $2)&quot;</span>,</a>
<a class="sourceLine" id="cb57-10" title="10">    <span class="dt">params =</span> <span class="kw">list</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dv">5</span><span class="op">:</span><span class="dv">8</span>)</a>
<a class="sourceLine" id="cb57-11" title="11">)</a>
<a class="sourceLine" id="cb57-12" title="12"><span class="kw">dbClearResult</span>(rs)</a>
<a class="sourceLine" id="cb57-13" title="13">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbReadTable</span>(<span class="st">&quot;cars&quot;</span>)</a>
<a class="sourceLine" id="cb57-14" title="14"><span class="co">##   speed dist</span></a>
<a class="sourceLine" id="cb57-15" title="15"><span class="co">## 1     4    2</span></a>
<a class="sourceLine" id="cb57-16" title="16"><span class="co">## 2     1    5</span></a>
<a class="sourceLine" id="cb57-17" title="17"><span class="co">## 3     2    6</span></a>
<a class="sourceLine" id="cb57-18" title="18"><span class="co">## 4     3    7</span></a>
<a class="sourceLine" id="cb57-19" title="19"><span class="co">## 5     4    8</span></a></code></pre></div>
<p>You can also pass parameters by using <code>dbBind()</code>.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb58-1" title="1"><span class="co"># overwirte cars table</span></a>
<a class="sourceLine" id="cb58-2" title="2">con <span class="op">%&gt;%</span><span class="st"> </span>DBI<span class="op">::</span><span class="kw">dbWriteTable</span>(<span class="st">&quot;cars&quot;</span>, cars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">1</span>), <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb58-3" title="3">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbReadTable</span>(<span class="st">&quot;cars&quot;</span>)</a>
<a class="sourceLine" id="cb58-4" title="4"><span class="co">##   speed dist</span></a>
<a class="sourceLine" id="cb58-5" title="5"><span class="co">## 1     4    2</span></a>
<a class="sourceLine" id="cb58-6" title="6"></a>
<a class="sourceLine" id="cb58-7" title="7"><span class="co"># pass multiple parameter using dbBind()</span></a>
<a class="sourceLine" id="cb58-8" title="8">rs &lt;-<span class="st"> </span><span class="kw">dbSendStatement</span>(</a>
<a class="sourceLine" id="cb58-9" title="9">    con,</a>
<a class="sourceLine" id="cb58-10" title="10">    <span class="st">&quot;INSERT INTO cars (speed, dist) VALUES ($1, $2)&quot;</span></a>
<a class="sourceLine" id="cb58-11" title="11">)</a>
<a class="sourceLine" id="cb58-12" title="12"><span class="kw">dbBind</span>(rs, <span class="kw">list</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>, <span class="dv">4</span><span class="op">:</span><span class="dv">5</span>))</a>
<a class="sourceLine" id="cb58-13" title="13"><span class="kw">dbBind</span>(rs, <span class="kw">list</span>(6L, 7L))</a>
<a class="sourceLine" id="cb58-14" title="14"><span class="kw">dbClearResult</span>(rs)</a>
<a class="sourceLine" id="cb58-15" title="15"><span class="kw">dbReadTable</span>(con, <span class="st">&quot;cars&quot;</span>)</a>
<a class="sourceLine" id="cb58-16" title="16"><span class="co">##   speed dist</span></a>
<a class="sourceLine" id="cb58-17" title="17"><span class="co">## 1     4    2</span></a>
<a class="sourceLine" id="cb58-18" title="18"><span class="co">## 2     2    4</span></a>
<a class="sourceLine" id="cb58-19" title="19"><span class="co">## 3     3    5</span></a>
<a class="sourceLine" id="cb58-20" title="20"><span class="co">## 4     6    7</span></a></code></pre></div>
</div>
<div id="dbbind" class="section level3 hasAnchor">
<h3><span class="header-section-number">2.3.5</span> <code>dbBind()</code><a href="#dbbind" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Binds placeholders in a parameterized/prepared statement to actual values.</li>
<li>Returns a result set invisibly.</li>
<li>Is intented to be called before calling <code>dbFetch()</code> or <code>dbGetRowsAffected()</code>.</li>
<li>The placeholder syntax depends on DBMS.
<ul>
<li><code>?</code>: RMySQL and RSQLite</li>
<li><code>$1</code>: RPostgres and RSQLite</li>
<li><code>:name</code> and <code>$name</code>: RSQLite.</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" title="1">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbWriteTable</span>(<span class="st">&quot;iris&quot;</span>, iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(), <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb59-2" title="2">rs &lt;-<span class="st"> </span>con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbSendQuery</span>(<span class="st">&quot;SELECT * FROM iris WHERE &#39;Petal.Width&#39; &gt; $1&quot;</span>)</a>
<a class="sourceLine" id="cb59-3" title="3">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbBind</span>(<span class="kw">list</span>(<span class="fl">3.0</span>))</a>
<a class="sourceLine" id="cb59-4" title="4"><span class="kw">dbFetch</span>(rs)</a>
<a class="sourceLine" id="cb59-5" title="5"><span class="co">##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></a>
<a class="sourceLine" id="cb59-6" title="6"><span class="co">## 1          5.1         3.5          1.4         0.2  setosa</span></a>
<a class="sourceLine" id="cb59-7" title="7"><span class="co">## 2          4.9         3.0          1.4         0.2  setosa</span></a>
<a class="sourceLine" id="cb59-8" title="8"><span class="co">## 3          4.7         3.2          1.3         0.2  setosa</span></a>
<a class="sourceLine" id="cb59-9" title="9"><span class="co">## 4          4.6         3.1          1.5         0.2  setosa</span></a>
<a class="sourceLine" id="cb59-10" title="10"><span class="co">## 5          5.0         3.6          1.4         0.2  setosa</span></a>
<a class="sourceLine" id="cb59-11" title="11"><span class="co">## 6          5.4         3.9          1.7         0.4  setosa</span></a></code></pre></div>
<p>See <code>dbSendQuery</code> and <code>dbSendStatement</code> for more examples.</p>
</div>
<div id="dbfetch-fetch" class="section level3 hasAnchor">
<h3><span class="header-section-number">2.3.6</span> <code>dbFetch(), fetch()</code><a href="#dbfetch-fetch" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Fetches the next <code>n</code> elements (rows) from the result set.</li>
<li>Returns a dataframe regardless of the result.</li>
<li>For all new code, use <code>dbFetch()</code> not <code>fetch()</code> which is provided just for compatibility with older DBI-client.</li>
</ul>
<p><code>dbFetch()</code> fetches unfetched results, as the next example shows.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" title="1">rs &lt;-<span class="st"> </span>con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbSendQuery</span>(<span class="st">&quot;SELECT mpg, cyl FROM mtcars LIMIT 10&quot;</span>)</a>
<a class="sourceLine" id="cb60-2" title="2"><span class="cf">while</span> (rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbHasCompleted</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">isFALSE</span>()) {</a>
<a class="sourceLine" id="cb60-3" title="3">    chunk &lt;-<span class="st"> </span><span class="kw">dbFetch</span>(rs, <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb60-4" title="4">    <span class="kw">print</span>(chunk)</a>
<a class="sourceLine" id="cb60-5" title="5">}</a>
<a class="sourceLine" id="cb60-6" title="6"><span class="co">##   mpg cyl</span></a>
<a class="sourceLine" id="cb60-7" title="7"><span class="co">## 1  21   6</span></a>
<a class="sourceLine" id="cb60-8" title="8"><span class="co">## 2  21   6</span></a>
<a class="sourceLine" id="cb60-9" title="9"><span class="co">##    mpg cyl</span></a>
<a class="sourceLine" id="cb60-10" title="10"><span class="co">## 1 22.8   4</span></a>
<a class="sourceLine" id="cb60-11" title="11"><span class="co">## 2 21.4   6</span></a>
<a class="sourceLine" id="cb60-12" title="12"><span class="co">##    mpg cyl</span></a>
<a class="sourceLine" id="cb60-13" title="13"><span class="co">## 1 18.7   8</span></a>
<a class="sourceLine" id="cb60-14" title="14"><span class="co">## 2 18.1   6</span></a>
<a class="sourceLine" id="cb60-15" title="15"><span class="co">##    mpg cyl</span></a>
<a class="sourceLine" id="cb60-16" title="16"><span class="co">## 1 14.3   8</span></a>
<a class="sourceLine" id="cb60-17" title="17"><span class="co">## 2 24.4   4</span></a>
<a class="sourceLine" id="cb60-18" title="18"><span class="co">##    mpg cyl</span></a>
<a class="sourceLine" id="cb60-19" title="19"><span class="co">## 1 22.8   4</span></a>
<a class="sourceLine" id="cb60-20" title="20"><span class="co">## 2 19.2   6</span></a>
<a class="sourceLine" id="cb60-21" title="21"></a>
<a class="sourceLine" id="cb60-22" title="22"><span class="kw">dbClearResult</span>(rs)</a></code></pre></div>
<p>Not all result objects can be fetched.
One such example is the result of query with a unbounded placeholder.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" title="1">rs &lt;-<span class="st"> </span>con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbSendQuery</span>(<span class="st">&quot;SELECT mpg, cyl, disp FROM mtcars WHERE cyl = $1&quot;</span>)</a>
<a class="sourceLine" id="cb61-2" title="2">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbFetch</span>(<span class="dt">n =</span> <span class="dv">5</span>) <span class="co"># placeholder should be bound before being fetched</span></a>
<a class="sourceLine" id="cb61-3" title="3"><span class="co">## Error: Query needs to be bound before fetching</span></a>
<a class="sourceLine" id="cb61-4" title="4">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbBind</span>(<span class="kw">list</span>(6L))</a>
<a class="sourceLine" id="cb61-5" title="5">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbClearResult</span>()</a></code></pre></div>
<p>More trivial result is a cleared result.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb62-1" title="1">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbClearResult</span>()</a>
<a class="sourceLine" id="cb62-2" title="2">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbFetch</span>()</a>
<a class="sourceLine" id="cb62-3" title="3"><span class="co">## Error: Invalid result set</span></a></code></pre></div>
</div>
<div id="dbgetrowcount" class="section level3 hasAnchor">
<h3><span class="header-section-number">2.3.7</span> <code>dbGetRowCount()</code><a href="#dbgetrowcount" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Counts the total number of rows <strong>actually returned</strong> by <code>dbFetch()</code> for the input result object.</li>
<li>Returns a scalar number.</li>
</ul>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb63-1" title="1">rs &lt;-<span class="st"> </span><span class="kw">dbSendQuery</span>(con, <span class="st">&quot;SELECT * FROM mtcars&quot;</span>)</a>
<a class="sourceLine" id="cb63-2" title="2"></a>
<a class="sourceLine" id="cb63-3" title="3">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbGetRowCount</span>() <span class="co"># initial value of the method</span></a>
<a class="sourceLine" id="cb63-4" title="4"><span class="co">## [1] 0</span></a>
<a class="sourceLine" id="cb63-5" title="5"></a>
<a class="sourceLine" id="cb63-6" title="6">count_fetched_rows &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb63-7" title="7"><span class="cf">while</span> (<span class="op">!</span><span class="kw">dbHasCompleted</span>(rs)) {</a>
<a class="sourceLine" id="cb63-8" title="8">    count_fetched_rows &lt;-<span class="st"> </span>count_fetched_rows <span class="op">+</span><span class="st"> </span><span class="kw">nrow</span>(rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbFetch</span>(<span class="dv">10</span>))</a>
<a class="sourceLine" id="cb63-9" title="9">}</a>
<a class="sourceLine" id="cb63-10" title="10"></a>
<a class="sourceLine" id="cb63-11" title="11">count_fetched_rows <span class="co"># total number of rows fetched</span></a>
<a class="sourceLine" id="cb63-12" title="12"><span class="co">## [1] 32</span></a>
<a class="sourceLine" id="cb63-13" title="13">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbGetRowCount</span>()</a>
<a class="sourceLine" id="cb63-14" title="14"><span class="co">## [1] 32</span></a>
<a class="sourceLine" id="cb63-15" title="15"></a>
<a class="sourceLine" id="cb63-16" title="16"><span class="co"># fetching empty row has no effect on the value of dbGetRowCount()</span></a>
<a class="sourceLine" id="cb63-17" title="17">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbFetch</span>()</a>
<a class="sourceLine" id="cb63-18" title="18"><span class="co">##  [1] mpg  cyl  disp hp   drat wt   qsec vs   am   gear carb</span></a>
<a class="sourceLine" id="cb63-19" title="19"><span class="co">## &lt;0 rows&gt; (or 0-length row.names)</span></a>
<a class="sourceLine" id="cb63-20" title="20">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbGetRowCount</span>()</a>
<a class="sourceLine" id="cb63-21" title="21"><span class="co">## [1] 32</span></a>
<a class="sourceLine" id="cb63-22" title="22"></a>
<a class="sourceLine" id="cb63-23" title="23">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbClearResult</span>()</a></code></pre></div>
<p><code>dbGetRowCount()</code> cannot count a cleared result.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb64-1" title="1">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbGetRowCount</span>()</a>
<a class="sourceLine" id="cb64-2" title="2"><span class="co">## Error: Invalid result set</span></a></code></pre></div>
</div>
<div id="dbgetrowsaffected" class="section level3 hasAnchor">
<h3><span class="header-section-number">2.3.8</span> <code>dbGetRowsAffected()</code><a href="#dbgetrowsaffected" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Gets the number of rows affected by a data manipulation statement issued with dbSendStatement()</li>
<li>Returns a scalar number, integer or numeric.</li>
</ul>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb65-1" title="1">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbWriteTable</span>(<span class="st">&quot;cars&quot;</span>, cars, <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb65-2" title="2">rs &lt;-<span class="st"> </span>con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbSendStatement</span>(<span class="st">&quot;DELETE FROM cars WHERE dist &gt;= 20&quot;</span>)</a>
<a class="sourceLine" id="cb65-3" title="3">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbGetRowsAffected</span>()</a>
<a class="sourceLine" id="cb65-4" title="4"><span class="co">## [1] 42</span></a>
<a class="sourceLine" id="cb65-5" title="5">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbClearResult</span>()</a></code></pre></div>
<p>The following example shows that <code>dbGetRowsAffected()</code> increases when placeholders get bounded, not when placeholders are placed.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb66-1" title="1">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbWriteTable</span>(<span class="st">&quot;cars&quot;</span>, cars, <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb66-2" title="2">rs &lt;-<span class="st"> </span>con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbSendStatement</span>(<span class="st">&quot;DELETE FROM cars WHERE speed = $1 AND dist = $2&quot;</span>)</a>
<a class="sourceLine" id="cb66-3" title="3">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbGetRowsAffected</span>()</a>
<a class="sourceLine" id="cb66-4" title="4"><span class="co">## [1] NA</span></a>
<a class="sourceLine" id="cb66-5" title="5">rs &lt;-<span class="st"> </span>rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbBind</span>(<span class="kw">list</span>(<span class="dv">7</span>, <span class="dv">21</span>))</a>
<a class="sourceLine" id="cb66-6" title="6">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbGetRowsAffected</span>() <span class="co"># there is no rows with that value</span></a>
<a class="sourceLine" id="cb66-7" title="7"><span class="co">## [1] 0</span></a>
<a class="sourceLine" id="cb66-8" title="8">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbClearResult</span>()</a></code></pre></div>
</div>
<div id="dbgetstatement" class="section level3 hasAnchor">
<h3><span class="header-section-number">2.3.9</span> <code>dbGetStatement()</code><a href="#dbgetstatement" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Gets the statement that was passed to <code>dbSendQuery()</code> or <code>dbSendStatement()</code>. It remains unchanged after placeholders are bounded afterwards.</li>
<li>Returns a string statement.</li>
</ul>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb67-1" title="1">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbWriteTable</span>(<span class="st">&quot;cars&quot;</span>, cars, <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb67-2" title="2">rs &lt;-<span class="st"> </span>con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbSendStatement</span>(<span class="st">&quot;SELECT * FROM cars WHERE dist &gt;= $1&quot;</span>)</a>
<a class="sourceLine" id="cb67-3" title="3">stm &lt;-<span class="st"> </span>rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbGetStatement</span>()</a>
<a class="sourceLine" id="cb67-4" title="4">stm <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">class</span>()</a>
<a class="sourceLine" id="cb67-5" title="5"><span class="co">## [1] &quot;character&quot;</span></a>
<a class="sourceLine" id="cb67-6" title="6">stm <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>()</a>
<a class="sourceLine" id="cb67-7" title="7"><span class="co">## [1] &quot;SELECT * FROM cars WHERE dist &gt;= $1&quot;</span></a>
<a class="sourceLine" id="cb67-8" title="8">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbBind</span>(<span class="kw">list</span>(<span class="dv">25</span>))</a>
<a class="sourceLine" id="cb67-9" title="9">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbGetStatement</span>() <span class="co"># unchanged!</span></a>
<a class="sourceLine" id="cb67-10" title="10"><span class="co">## [1] &quot;SELECT * FROM cars WHERE dist &gt;= $1&quot;</span></a>
<a class="sourceLine" id="cb67-11" title="11">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbFetch</span>(<span class="dt">n =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb67-12" title="12"><span class="co">##   speed dist</span></a>
<a class="sourceLine" id="cb67-13" title="13"><span class="co">## 1    10   26</span></a>
<a class="sourceLine" id="cb67-14" title="14"><span class="co">## 2    10   34</span></a>
<a class="sourceLine" id="cb67-15" title="15"><span class="co">## 3    11   28</span></a>
<a class="sourceLine" id="cb67-16" title="16"><span class="co">## 4    12   28</span></a>
<a class="sourceLine" id="cb67-17" title="17"><span class="co">## 5    13   26</span></a>
<a class="sourceLine" id="cb67-18" title="18">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbClearResult</span>()</a>
<a class="sourceLine" id="cb67-19" title="19"></a>
<a class="sourceLine" id="cb67-20" title="20"><span class="co"># reuse the derived statement</span></a>
<a class="sourceLine" id="cb67-21" title="21">rs &lt;-<span class="st"> </span>con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbSendStatement</span>(stm)</a>
<a class="sourceLine" id="cb67-22" title="22">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbBind</span>(<span class="kw">list</span>(<span class="dv">35</span>))</a>
<a class="sourceLine" id="cb67-23" title="23">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbFetch</span>(<span class="dt">n =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb67-24" title="24"><span class="co">##   speed dist</span></a>
<a class="sourceLine" id="cb67-25" title="25"><span class="co">## 1    13   46</span></a>
<a class="sourceLine" id="cb67-26" title="26"><span class="co">## 2    14   36</span></a>
<a class="sourceLine" id="cb67-27" title="27"><span class="co">## 3    14   60</span></a>
<a class="sourceLine" id="cb67-28" title="28"><span class="co">## 4    14   80</span></a>
<a class="sourceLine" id="cb67-29" title="29"><span class="co">## 5    15   54</span></a>
<a class="sourceLine" id="cb67-30" title="30">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbClearResult</span>()</a></code></pre></div>
</div>
<div id="dbhascompleted" class="section level3 hasAnchor">
<h3><span class="header-section-number">2.3.10</span> <code>dbHasCompleted()</code><a href="#dbhascompleted" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Tests if the associated operation has completed.</li>
<li>Returns a logical. <code>TRUE</code> if there is nothing more to be fetched and <code>FALSE</code> if otherwise.</li>
</ul>
<p><code>SELECT</code> statement completes when all results, if any, have been fetched.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb68-1" title="1">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbWriteTable</span>(<span class="st">&quot;mtcars&quot;</span>, mtcars, <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb68-2" title="2">rs &lt;-<span class="st"> </span>con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbSendQuery</span>(<span class="st">&quot;SELECT * FROM mtcars&quot;</span>)</a>
<a class="sourceLine" id="cb68-3" title="3">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbHasCompleted</span>()</a>
<a class="sourceLine" id="cb68-4" title="4"><span class="co">## [1] FALSE</span></a>
<a class="sourceLine" id="cb68-5" title="5">rs <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb68-6" title="6"><span class="st">    </span><span class="kw">dbFetch</span>(<span class="dt">n =</span> <span class="dv">20</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb68-7" title="7"><span class="st">    </span><span class="kw">invisible</span>() <span class="co"># discard</span></a>
<a class="sourceLine" id="cb68-8" title="8">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbHasCompleted</span>()</a>
<a class="sourceLine" id="cb68-9" title="9"><span class="co">## [1] FALSE</span></a>
<a class="sourceLine" id="cb68-10" title="10">rs <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb68-11" title="11"><span class="st">    </span><span class="kw">dbFetch</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb68-12" title="12"><span class="st">    </span><span class="kw">invisible</span>() <span class="co"># discard</span></a>
<a class="sourceLine" id="cb68-13" title="13">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbHasCompleted</span>()</a>
<a class="sourceLine" id="cb68-14" title="14"><span class="co">## [1] TRUE</span></a>
<a class="sourceLine" id="cb68-15" title="15">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbClearResult</span>()</a></code></pre></div>
<p><code>SELECT</code> statement with no result rows completes as soon as the query is executed. Consequently, there is no need to fetch it to get it completed.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" title="1">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbWriteTable</span>(<span class="st">&quot;mtcars&quot;</span>, mtcars, <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb69-2" title="2">rs &lt;-<span class="st"> </span>con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbSendQuery</span>(<span class="st">&quot;SELECT * FROM mtcars WHERE cyl = 5&quot;</span>)</a>
<a class="sourceLine" id="cb69-3" title="3">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbHasCompleted</span>()</a>
<a class="sourceLine" id="cb69-4" title="4"><span class="co">## [1] TRUE</span></a>
<a class="sourceLine" id="cb69-5" title="5">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbClearResult</span>()</a></code></pre></div>
<p><code>DELETE</code>, <code>INSERT</code> and <code>UPDATE</code> statements get completed immediately after execution because there is originally nothing to fetch.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb70-1" title="1">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbWriteTable</span>(<span class="st">&quot;cars&quot;</span>, cars, <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb70-2" title="2">rs &lt;-<span class="st"> </span>con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbSendStatement</span>(<span class="st">&quot;DELETE FROM cars WHERE speed &gt;= 8&quot;</span>)</a>
<a class="sourceLine" id="cb70-3" title="3">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbHasCompleted</span>()</a>
<a class="sourceLine" id="cb70-4" title="4"><span class="co">## [1] TRUE</span></a>
<a class="sourceLine" id="cb70-5" title="5">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbClearResult</span>()</a></code></pre></div>
</div>
<div id="dbcolumninfo" class="section level3 hasAnchor">
<h3><span class="header-section-number">2.3.11</span> <code>dbColumnInfo()</code><a href="#dbcolumninfo" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Returns <code>data.frame</code> that describes the output of a query.</li>
<li>A returned <code>data.frame</code> at least includes <code>"name"</code> and <code>"type"</code> followed by optional columns that starts with a dot such as <code>".oid"</code> and <code>".typname"</code> depending on DBMS.</li>
</ul>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb71-1" title="1">rs &lt;-<span class="st"> </span>con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbSendQuery</span>(</a>
<a class="sourceLine" id="cb71-2" title="2">    <span class="st">&quot;</span></a>
<a class="sourceLine" id="cb71-3" title="3"><span class="st">    SELECT 3.14 AS pi,</span></a>
<a class="sourceLine" id="cb71-4" title="4"><span class="st">    0 AS unit_addition,</span></a>
<a class="sourceLine" id="cb71-5" title="5"><span class="st">    &#39;shena&#39; AS author,</span></a>
<a class="sourceLine" id="cb71-6" title="6"><span class="st">    current_date AS today</span></a>
<a class="sourceLine" id="cb71-7" title="7"><span class="st">    &quot;</span></a>
<a class="sourceLine" id="cb71-8" title="8">)</a>
<a class="sourceLine" id="cb71-9" title="9">info &lt;-<span class="st"> </span>rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbColumnInfo</span>()</a>
<a class="sourceLine" id="cb71-10" title="10">info <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">class</span>()</a>
<a class="sourceLine" id="cb71-11" title="11"><span class="co">## [1] &quot;data.frame&quot;</span></a>
<a class="sourceLine" id="cb71-12" title="12">info <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mode</span>()</a>
<a class="sourceLine" id="cb71-13" title="13"><span class="co">## [1] &quot;list&quot;</span></a>
<a class="sourceLine" id="cb71-14" title="14">info <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>()</a>
<a class="sourceLine" id="cb71-15" title="15"><span class="co">##            name      type .oid .known .typname</span></a>
<a class="sourceLine" id="cb71-16" title="16"><span class="co">## 1            pi    double 1700   TRUE  numeric</span></a>
<a class="sourceLine" id="cb71-17" title="17"><span class="co">## 2 unit_addition   integer   23   TRUE     int4</span></a>
<a class="sourceLine" id="cb71-18" title="18"><span class="co">## 3        author character   25   TRUE     text</span></a>
<a class="sourceLine" id="cb71-19" title="19"><span class="co">## 4         today    double 1082   TRUE     date</span></a>
<a class="sourceLine" id="cb71-20" title="20">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbFetch</span>(<span class="dt">n =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb71-21" title="21"><span class="co">## [1] pi            unit_addition author        today        </span></a>
<a class="sourceLine" id="cb71-22" title="22"><span class="co">## &lt;0 rows&gt; (or 0-length row.names)</span></a>
<a class="sourceLine" id="cb71-23" title="23">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbClearResult</span>()</a></code></pre></div>
<p>Information about result types</p>
</div>
<div id="dbclearresult" class="section level3 hasAnchor">
<h3><span class="header-section-number">2.3.12</span> <code>dbClearResult()</code><a href="#dbclearresult" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Frees all resources (local and remote) associated with a result set.</li>
<li>Returns <code>TRUE</code> invisibly.</li>
<li>MUST follow <code>dbSendQuery()</code> and <code>dbSendStatement()</code>.</li>
</ul>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb72-1" title="1">rs &lt;-<span class="st"> </span>con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbSendQuery</span>(<span class="st">&quot;SELECT 3.14 AS pi&quot;</span>)</a>
<a class="sourceLine" id="cb72-2" title="2">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbFetch</span>()</a>
<a class="sourceLine" id="cb72-3" title="3"><span class="co">##     pi</span></a>
<a class="sourceLine" id="cb72-4" title="4"><span class="co">## 1 3.14</span></a>
<a class="sourceLine" id="cb72-5" title="5">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbClearResult</span>()</a>
<a class="sourceLine" id="cb72-6" title="6">rs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbClearResult</span>() <span class="co"># clearing a cleared result again raises warning</span></a></code></pre></div>

</div>
</div>
<div id="sql" class="section level2 hasAnchor">
<h2><span class="header-section-number">2.4</span> SQL<a href="#sql" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="sql-1" class="section level3 hasAnchor">
<h3><span class="header-section-number">2.4.1</span> <code>SQL()</code><a href="#sql-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Hndles SQL quoting.</li>
<li>Returns a <code>SQL</code> class object.</li>
<li>See <code>dbQuoteIdentifier()</code> or <code>dbQuoteLiteral()</code> for similar (but different) quoting methods.</li>
<li>See <code>sqlInterpolate()</code> for an application.</li>
<li><code>glue_sql()</code> in glue packages is also useful to deal with SQL escaping needs.</li>
</ul>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb73-1" title="1">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbDisconnect</span>()</a>
<a class="sourceLine" id="cb73-2" title="2">con &lt;-<span class="st"> </span><span class="kw">issue_con</span>(<span class="st">&quot;demo&quot;</span>)</a>
<a class="sourceLine" id="cb73-3" title="3">str &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;SELECT&quot;</span>, <span class="st">&quot;WHERE&quot;</span>)</a>
<a class="sourceLine" id="cb73-4" title="4">s &lt;-<span class="st"> </span><span class="kw">SQL</span>(str)</a>
<a class="sourceLine" id="cb73-5" title="5">s <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">class</span>()</a>
<a class="sourceLine" id="cb73-6" title="6"><span class="co">## [1] &quot;SQL&quot;</span></a>
<a class="sourceLine" id="cb73-7" title="7"><span class="co">## attr(,&quot;package&quot;)</span></a>
<a class="sourceLine" id="cb73-8" title="8"><span class="co">## [1] &quot;DBI&quot;</span></a>
<a class="sourceLine" id="cb73-9" title="9">s <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>()</a>
<a class="sourceLine" id="cb73-10" title="10"><span class="co">## &lt;SQL&gt; SELECT</span></a>
<a class="sourceLine" id="cb73-11" title="11"><span class="co">## &lt;SQL&gt; WHERE</span></a>
<a class="sourceLine" id="cb73-12" title="12"></a>
<a class="sourceLine" id="cb73-13" title="13"><span class="kw">SQL</span>(s) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>() <span class="co"># unchanged</span></a>
<a class="sourceLine" id="cb73-14" title="14"><span class="co">## &lt;SQL&gt; SELECT</span></a>
<a class="sourceLine" id="cb73-15" title="15"><span class="co">## &lt;SQL&gt; WHERE</span></a>
<a class="sourceLine" id="cb73-16" title="16"></a>
<a class="sourceLine" id="cb73-17" title="17"><span class="kw">dbQuoteLiteral</span>(con, s) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>() <span class="co"># SQL vectors pass through dbQuoteLiteral()</span></a>
<a class="sourceLine" id="cb73-18" title="18"><span class="co">## &lt;SQL&gt; SELECT</span></a>
<a class="sourceLine" id="cb73-19" title="19"><span class="co">## &lt;SQL&gt; WHERE</span></a>
<a class="sourceLine" id="cb73-20" title="20"></a>
<a class="sourceLine" id="cb73-21" title="21">lt &lt;-<span class="st"> </span><span class="kw">dbQuoteLiteral</span>(con, str)</a>
<a class="sourceLine" id="cb73-22" title="22">lt <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>()</a>
<a class="sourceLine" id="cb73-23" title="23"><span class="co">## &lt;SQL&gt; &#39;SELECT&#39;</span></a>
<a class="sourceLine" id="cb73-24" title="24"><span class="co">## &lt;SQL&gt; &#39;WHERE&#39;</span></a>
<a class="sourceLine" id="cb73-25" title="25"></a>
<a class="sourceLine" id="cb73-26" title="26"><span class="kw">dbQuoteLiteral</span>(con, lt) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>() <span class="co"># double escaping doesn&#39;t happen</span></a>
<a class="sourceLine" id="cb73-27" title="27"><span class="co">## &lt;SQL&gt; &#39;SELECT&#39;</span></a>
<a class="sourceLine" id="cb73-28" title="28"><span class="co">## &lt;SQL&gt; &#39;WHERE&#39;</span></a></code></pre></div>
</div>
<div id="dbdatatype" class="section level3 hasAnchor">
<h3><span class="header-section-number">2.4.2</span> <code>dbDataType()</code><a href="#dbdatatype" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Describes the corresponding SQL data type for the DBMS.</li>
<li>Returns a character string.</li>
<li>Works without valid connection.</li>
</ul>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb74-1" title="1">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbDataType</span>(<span class="kw">Sys.Date</span>()) <span class="co"># specify DB by connection</span></a>
<a class="sourceLine" id="cb74-2" title="2"><span class="co">## [1] &quot;DATE&quot;</span></a>
<a class="sourceLine" id="cb74-3" title="3"><span class="co"># works with a disconnected connection variable</span></a>
<a class="sourceLine" id="cb74-4" title="4">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbDisconnect</span>()</a>
<a class="sourceLine" id="cb74-5" title="5">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbDataType</span>(<span class="kw">Sys.time</span>())</a>
<a class="sourceLine" id="cb74-6" title="6"><span class="co">## [1] &quot;TIMESTAMPTZ&quot;</span></a>
<a class="sourceLine" id="cb74-7" title="7">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbDataType</span>(<span class="kw">Sys.time</span>() <span class="op">-</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="kw">Sys.Date</span>()))</a>
<a class="sourceLine" id="cb74-8" title="8"><span class="co">## [1] &quot;TIME&quot;</span></a>
<a class="sourceLine" id="cb74-9" title="9">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbDataType</span>(<span class="kw">c</span>(<span class="st">&quot;pi&quot;</span>, <span class="st">&quot;e&quot;</span>))</a>
<a class="sourceLine" id="cb74-10" title="10"><span class="co">## [1] &quot;TEXT&quot;</span></a>
<a class="sourceLine" id="cb74-11" title="11">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbDataType</span>(<span class="kw">list</span>(<span class="kw">raw</span>(<span class="dv">10</span>), <span class="kw">raw</span>(<span class="dv">20</span>)))</a>
<a class="sourceLine" id="cb74-12" title="12"><span class="co">## [1] &quot;BYTEA&quot;</span></a>
<a class="sourceLine" id="cb74-13" title="13">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbDataType</span>(<span class="kw">I</span>(<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb74-14" title="14"><span class="co">## [1] &quot;DOUBLE PRECISION&quot;</span></a>
<a class="sourceLine" id="cb74-15" title="15">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbDataType</span>(iris)</a>
<a class="sourceLine" id="cb74-16" title="16"><span class="co">##       Sepal.Length        Sepal.Width       Petal.Length        Petal.Width </span></a>
<a class="sourceLine" id="cb74-17" title="17"><span class="co">## &quot;DOUBLE PRECISION&quot; &quot;DOUBLE PRECISION&quot; &quot;DOUBLE PRECISION&quot; &quot;DOUBLE PRECISION&quot; </span></a>
<a class="sourceLine" id="cb74-18" title="18"><span class="co">##            Species </span></a>
<a class="sourceLine" id="cb74-19" title="19"><span class="co">##             &quot;TEXT&quot;</span></a>
<a class="sourceLine" id="cb74-20" title="20">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbDataType</span>(<span class="ot">NA</span>)</a>
<a class="sourceLine" id="cb74-21" title="21"><span class="co">## [1] &quot;BOOLEAN&quot;</span></a>
<a class="sourceLine" id="cb74-22" title="22">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbDataType</span>(<span class="ot">NULL</span>) <span class="co"># error</span></a>
<a class="sourceLine" id="cb74-23" title="23"><span class="co">## Error: Unsupported type</span></a></code></pre></div>
<p>You can also pass a <code>DBIDriver</code> object to specify the target DB.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb75-1" title="1"><span class="kw">dbDataType</span>(RPostgres<span class="op">::</span><span class="kw">Postgres</span>(), <span class="dv">1</span>) <span class="co"># specify DB by driver</span></a>
<a class="sourceLine" id="cb75-2" title="2"><span class="co">## [1] &quot;DOUBLE PRECISION&quot;</span></a>
<a class="sourceLine" id="cb75-3" title="3"><span class="kw">dbDataType</span>(RPostgres<span class="op">::</span><span class="kw">Postgres</span>(), iris) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">class</span>()</a>
<a class="sourceLine" id="cb75-4" title="4"><span class="co">## [1] &quot;character&quot;</span></a></code></pre></div>
</div>
<div id="dbquoteidentifier" class="section level3 hasAnchor">
<h3><span class="header-section-number">2.4.3</span> <code>dbQuoteIdentifier()</code><a href="#dbquoteidentifier" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="dbquoteliteral" class="section level3 hasAnchor">
<h3><span class="header-section-number">2.4.4</span> <code>dbQuoteLiteral()</code><a href="#dbquoteliteral" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="sqlinterpolate" class="section level3 hasAnchor">
<h3><span class="header-section-number">2.4.5</span> <code>sqlInterpolate()</code><a href="#sqlinterpolate" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Create a SQL statement from a query string with a greater flexibility than <code>dbExecute()</code> or <code>dbGetQuery()</code>.</li>
<li>Returns SQL of <code>SQL</code> class.</li>
<li>Accepts placeholders with one of the following two syntaxes. They should be bounded by <code>.dots = list()</code>.
<ul>
<li><code>?,...,?</code>: bounded by an unnamed list.</li>
<li><code>?name1,...,?name2</code>: bounded by a named list.</li>
</ul></li>
<li>All values in <code>.dots = list()</code> will be first escaped with <code>dbQuoteLiteral()</code> to protect against SQL injection.</li>
</ul>
<p><a href="https://dbi.r-dbi.org/reference/sqlinterpolate">DBI references</a> has many examples including several anti-patterns that should be taken care of.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb76-1" title="1">con &lt;-<span class="st"> </span><span class="kw">issue_con</span>(<span class="st">&quot;demo&quot;</span>)</a>
<a class="sourceLine" id="cb76-2" title="2">sql &lt;-<span class="st"> &quot;SELECT * FROM ?&quot;</span></a>
<a class="sourceLine" id="cb76-3" title="3">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sqlInterpolate</span>(</a>
<a class="sourceLine" id="cb76-4" title="4">    <span class="dt">sql =</span> sql,</a>
<a class="sourceLine" id="cb76-5" title="5">    <span class="dt">.dots =</span> <span class="kw">list</span>(<span class="st">&quot;mtcars&quot;</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbQuoteIdentifier</span>(con, .))</a>
<a class="sourceLine" id="cb76-6" title="6">)</a>
<a class="sourceLine" id="cb76-7" title="7"><span class="co">## &lt;SQL&gt; SELECT * FROM &quot;mtcars&quot;</span></a></code></pre></div>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb77-1" title="1">sql &lt;-<span class="st"> &quot;SELECT ?p AS ?name&quot;</span></a>
<a class="sourceLine" id="cb77-2" title="2">stm &lt;-<span class="st"> </span>con <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb77-3" title="3"><span class="st">    </span><span class="kw">sqlInterpolate</span>(</a>
<a class="sourceLine" id="cb77-4" title="4">        <span class="dt">sql =</span> sql,</a>
<a class="sourceLine" id="cb77-5" title="5">        <span class="dt">p =</span> <span class="fl">3.14</span>,</a>
<a class="sourceLine" id="cb77-6" title="6">        <span class="dt">name =</span> <span class="st">&quot;pi&quot;</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbQuoteIdentifier</span>(con, .)</a>
<a class="sourceLine" id="cb77-7" title="7">    )</a>
<a class="sourceLine" id="cb77-8" title="8">stm <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>()</a>
<a class="sourceLine" id="cb77-9" title="9"><span class="co">## &lt;SQL&gt; SELECT 3.14::float8 AS &quot;pi&quot;</span></a>
<a class="sourceLine" id="cb77-10" title="10"></a>
<a class="sourceLine" id="cb77-11" title="11">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbGetQuery</span>(stm)</a>
<a class="sourceLine" id="cb77-12" title="12"><span class="co">##     pi</span></a>
<a class="sourceLine" id="cb77-13" title="13"><span class="co">## 1 3.14</span></a></code></pre></div>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb78-1" title="1">sql &lt;-<span class="st"> &quot;DISCARD ?var&quot;</span></a>
<a class="sourceLine" id="cb78-2" title="2">all &lt;-<span class="st"> </span><span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb78-3" title="3"></a>
<a class="sourceLine" id="cb78-4" title="4">con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sqlInterpolate</span>(</a>
<a class="sourceLine" id="cb78-5" title="5">    sql,</a>
<a class="sourceLine" id="cb78-6" title="6">    <span class="dt">var =</span> <span class="kw">if_else</span>(all, <span class="st">&quot;ALL&quot;</span>, <span class="st">&quot;TEMPORARY&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">SQL</span>()</a>
<a class="sourceLine" id="cb78-7" title="7">)</a>
<a class="sourceLine" id="cb78-8" title="8"><span class="co">## &lt;SQL&gt; DISCARD TEMPORARY</span></a></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>


    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "night",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "none",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"info": true
});
});
</script>

</body>

</html>
